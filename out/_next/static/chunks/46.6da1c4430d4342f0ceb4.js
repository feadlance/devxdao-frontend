(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[46],{FvLl:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),s=n("1OyB"),i=n("vuIU"),o=n("JX7q"),a=n("Ji7U"),c=n("md7G"),l=n("foSv"),u=n("rePB"),p=n("q1tI"),d=n("/MKj"),b=n("Ty5D"),h=n("ZpDd"),j=n("LADp"),m=n("eySl"),f=n("I6fM"),O=n("YW6W"),v=n("J/zA"),g=n("20Bz");n("ltsK");function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var s=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=n("wd/R"),k=function(e){Object(a.a)(n,e);var t=w(n);function n(e){var r;return Object(s.a)(this,n),r=t.call(this,e),Object(u.a)(Object(o.a)(r),"closeForm",(function(e){e.preventDefault();var t=r.props.onClose;t&&t()})),Object(u.a)(Object(o.a)(r),"selectWhatSection",(function(e){var t=r.props.proposal,n=e.target.value,s="",i=null;"short_description"==n?s=t.short_description:"total_grant"==n?s=t.total_grant.toString():"previous_work"==n?s=t.previous_work:"other_work"==n?s=t.other_work:"milestone"==n?(s={milestones:t.milestones,total_grant:t.total_grant},i=t.milestones[0].id):"citation"==n&&(s={citations:t.citations},i=t.citations[0]?t.citations[0].id:null),r.setState({change_to:"",additional_notes:"",what_section:n,current_submission:s,current_submission_id:i},(function(){r.checkButtonStatus()}))})),Object(u.a)(Object(o.a)(r),"selectMilestone",(function(e){r.setState(_(_({},r.state),{},{current_submission_id:e.target.value,change_to:""}),(function(){r.checkButtonStatus()}))})),Object(u.a)(Object(o.a)(r),"selectCitation",(function(e){r.setState(_(_({},r.state),{},{current_submission_id:e.target.value,change_to:""}),(function(){r.checkButtonStatus()}))})),Object(u.a)(Object(o.a)(r),"submitChange",(function(e){e.preventDefault();var t=r.props,n=t.proposal,s=t.onClose,i=r.state,o=i.what_section,a=i.change_to,c=i.additional_notes;if(o.trim())if(a.trim()||"remove_membership"==o)if(c.trim())if("total_grant"!=o||a.trim()&&!(parseFloat(O.a.unformatNumber(a.toString()))<=0)){var l={proposal:n.id,what_section:o,change_to:a,additional_notes:c,grant:0};r.props.dispatch(Object(j.rc)(l,(function(){r.props.dispatch(Object(h.wb)())}),(function(e){r.props.dispatch(Object(h.P)()),e.success&&(s&&s(),r.props.dispatch(Object(h.vb)("You've successfully proposed a change","success")))})))}else r.props.dispatch(Object(h.vb)("Please input valid total grant amount"));else r.props.dispatch(Object(h.vb)("Please input additional notes"));else r.props.dispatch(Object(h.vb)("Please input what change you will make"));else r.props.dispatch(Object(h.vb)("Please input what section you make a change to"))})),Object(u.a)(Object(o.a)(r),"handleKeyDown",(function(e){if("Tab"==e.key){e.preventDefault();var t=e.target.selectionStart,n=e.target.selectionEnd;e.target.value=e.target.value.substring(0,t)+"\t"+e.target.value.substring(n),e.target.selectionStart=e.target.selectionEnd=t+1}})),r.state={buttonDisabled:!0,what_section:"",change_to:"",additional_notes:"",current_submission:"",current_submission_id:null},r}return Object(i.a)(n,[{key:"inputField",value:function(e,t){var n=this;this.setState(Object(u.a)({},t,e.target.value),(function(){n.checkButtonStatus()}))}},{key:"inputEuroField",value:function(e,t){var n=this,r=e.target.value;r=O.a.unformatPriceNumber(r),isNaN(r)&&(r=""),r=O.a.adjustNumericString(r,2),this.setState(Object(u.a)({},t,r),(function(){n.checkButtonStatus()}))}},{key:"checkCitationsError",value:function(){var e=this.state,t=e.change_to,n=e.current_submission,r=e.current_submission_id;if(!t)return!0;var s=JSON.parse(t),i=0,o=!1;if(s.proposalId&&s.explanation&&""!=s.percentage)if(s.checked&&s.validProposal&&s.proposal&&s.proposal.id){if(r&&"new"!==r)i=n.citations.filter((function(e){return e.id!==r})).reduce((function(e,t){return e+ +t.percentage}),0)+ +s.percentage;else i=n.citations.reduce((function(e,t){return e+ +t.percentage}),0)+ +s.percentage}else o=!0;else o=!0;return!o&&+i>100&&(o=!0),console.log(o,i),o}},{key:"checkMilestonesError",value:function(){var e=this.state,t=e.change_to,n=e.current_submission,r=e.current_submission_id,s=this.props.proposal;if(!t)return!0;var i=!1;if(!s.total_grant||parseFloat(O.a.unformatNumber(s.total_grant))<=0)i=!0;else{var o=JSON.parse(t);o.title.trim()&&o.details.trim()&&o.criteria.trim()&&o.deadline.trim()&&o.level_difficulty.trim()&&o.checked||(i=!0);var a=n.milestones.filter((function(e){return e.id!==r})).reduce((function(e,t){return e+ +t.grant}),0);s.total_grant<a+ +o.grant&&(i=!0)}return i}},{key:"checkButtonStatus",value:function(){var e=this.state,t=e.what_section,n=e.change_to,r=e.additional_notes,s=!0;("remove_membership"==t.trim()&&r.trim()||"citation"==t.trim()&&!this.checkCitationsError()&&r.trim()||"milestone"==t.trim()&&!this.checkMilestonesError()&&r.trim()||!["milestone","citation","remove_membership"].includes(t)&&n.trim()&&r.trim())&&(s=!1),this.setState(_(_({},this.state),{},{buttonDisabled:s}))}},{key:"renderWhatSectionDropdown",value:function(){var e=this.state.what_section,t=this.props.proposal;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{className:"d-block mb-20",children:[Object(r.jsx)("label",{className:"mb-12",children:"What Section?"}),Object(r.jsxs)("select",{value:e,onChange:this.selectWhatSection,children:[Object(r.jsx)("option",{value:"",children:"Select..."}),Object(r.jsx)("option",{value:"short_description",children:"Proposal Description"}),"grant"==t.type?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("option",{value:"total_grant",children:"Grant Total"}),Object(r.jsx)("option",{value:"previous_work",children:"OP's Previous Work"}),Object(r.jsx)("option",{value:"other_work",children:"Other Previous Work"})]}):null,t.include_membership?Object(r.jsx)("option",{value:"remove_membership",children:"Remove Membership"}):null,t.milestones.length>0?Object(r.jsx)("option",{value:"milestone",children:"Milestone"}):null,Object(r.jsx)("option",{value:"citation",children:"Citation"})]})]}),"milestone"===e&&Object(r.jsxs)("div",{className:"d-block mb-20",children:[Object(r.jsx)("label",{className:"mb-12",children:"What Milestone?"}),Object(r.jsx)("select",{value:this.state.current_submission_id,onChange:this.selectMilestone,children:t.milestones.map((function(e,t){return Object(r.jsx)("option",{value:e.id,children:e.title},t)}))})]}),"citation"===e&&Object(r.jsxs)("div",{className:"d-block mb-20",children:[Object(r.jsx)("label",{className:"mb-12",children:"What Citation?"}),Object(r.jsxs)("select",{value:this.state.current_submission_id,onChange:this.selectCitation,children:[t.citations.map((function(e,t){return Object(r.jsxs)("option",{value:e.id,children:["Citation ",t+1]},t)})),Object(r.jsx)("option",{value:"new",children:"+ New Citation"},"new")]})]})]})}},{key:"renderMilestone",value:function(){var e=this.state,t=e.current_submission,n=e.current_submission_id,s=t.milestones.find((function(e){return e.id==n}));return Object(r.jsxs)("div",{children:[Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Title of Milestone (10 word limit)"}),Object(r.jsx)("p",{className:"mb-20",children:s.title}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Details of what will be delivered in milestone"}),Object(r.jsx)("p",{className:"mb-20",children:s.details}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Acceptance criteria: Please enter the specific details on what\n            the deliverable must do to prove this milestone is complete."}),Object(r.jsx)("p",{className:"mb-20",children:s.criteria}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Grant portion requested for this milestone"}),Object(r.jsx)("p",{className:"mb-20",children:O.a.formatPriceNumber(s.grant.toString())}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Deadline"}),Object(r.jsx)("p",{className:"mb-20",children:s.deadline?y(s.deadline).format("M/D/YYYY"):""}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Level of Difficulty"}),Object(r.jsx)("p",{className:"mb-20",children:s.level_difficulty})]},"milestone_".concat(n))}},{key:"renderCitation",value:function(){var e=this.state,t=e.current_submission,n=e.current_submission_id,s=t.citations.find((function(e){return e.id==n}));return Object(r.jsxs)("div",{children:[Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Cited Proposal Number"}),Object(r.jsx)("p",{className:"mb-20",children:s.rep_proposal_id}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Cited Proposal Title"}),Object(r.jsx)("p",{className:"mb-20",children:s.rep_proposal.title}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Cited Proposal OP"}),Object(r.jsx)("p",{className:"mb-20",children:s.rep_proposal.user.profile.forum_name}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Explain how this work is foundational to your work"}),Object(r.jsx)("p",{className:"mb-20",children:s.explanation}),Object(r.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"% of the rep gained from this proposal do you wish to give to the OP of the prior work"}),Object(r.jsx)("p",{className:"mb-20",children:s.percentage})]})}},{key:"renderCurrentSubmission",value:function(){var e=this.state,t=e.current_submission,n=e.what_section,s=e.current_submission_id;return t?"total_grant"==n?Object(r.jsxs)("div",{className:"c-form-row",children:[Object(r.jsx)("label",{children:"Current Submission"}),Object(r.jsxs)("div",{className:"app-readonly-box",children:[O.a.formatPriceNumber(t)," Euro"]})]}):"milestone"===n?Object(r.jsxs)("div",{className:"c-form-row",children:[Object(r.jsx)("label",{children:"Change From"}),Object(r.jsx)("div",{className:"app-box",children:this.renderMilestone()})]}):"citation"===n?s&&"new"!==s?Object(r.jsxs)("div",{className:"c-form-row",children:[Object(r.jsx)("label",{children:"Change From"}),Object(r.jsx)("div",{className:"app-box",children:this.renderCitation()})]}):Object(r.jsx)(r.Fragment,{}):Object(r.jsxs)("div",{className:"c-form-row",children:[Object(r.jsx)("label",{children:"Current Submission"}),Object(r.jsx)("div",{className:"app-readonly-box",children:t})]}):null}},{key:"renderChangeTo",value:function(){var e=this,t=this.state,n=t.change_to,s=t.what_section,i=t.current_submission,o=t.current_submission_id;if("remove_membership"==s)return null;if(["","short_description","total_grant","previous_work","other_work"].includes(s))return Object(r.jsxs)("div",{className:"c-form-row",children:[Object(r.jsx)("label",{children:"Change to:"}),"total_grant"!=s?Object(r.jsx)("textarea",{value:n,onChange:function(t){return e.inputField(t,"change_to")}}):Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{type:"text",value:O.a.formatPriceNumber(n.toString()),onChange:function(t){return e.inputEuroField(t,"change_to")}}),Object(r.jsx)("label",{children:"Euro"})]})]});if("milestone"===s){var a,c=JSON.parse(JSON.stringify(i.milestones)),l=c.findIndex((function(e){return e.id==o})),u=c[l].grant;return a=n?JSON.parse(n):c[l],Object(r.jsxs)("div",{className:"c-form-row",children:[Object(r.jsx)("label",{children:"Change to:"}),Object(r.jsx)("div",{className:"app-box",children:Object(r.jsx)(v.a,{showAction:!1,total_grant:u,milestones:[a],onUpdate:function(t){e.setState(_(_({},e.state),{},{change_to:JSON.stringify(t[0])}),(function(){e.checkButtonStatus()}))}})})]})}if("citation"===s){var p,d=JSON.parse(JSON.stringify(i.citations)),b=d.findIndex((function(e){return e.id==o}));p=n?JSON.parse(n):d[b];var h=100-i.citations.reduce((function(e,t){return e+ +t.percentage}),0);return o&&"new"!==o&&(h=+h+ +i.citations[b].percentage),Object(r.jsxs)("div",{className:"c-form-row",children:[Object(r.jsx)("label",{children:"Change to:"}),Object(r.jsx)("div",{className:"app-box",children:Object(r.jsx)(g.a,{showAction:!1,checkCustomSum:h,citations:p?[p]:[{proposalId:"",explanation:"",percentage:"",validProposal:!1,checked:!1,proposal:{}}],onUpdate:function(t){var n=_(_({},t[0]),{},{rep_proposal:t[0].proposal,rep_proposal_id:t[0].proposal?t[0].proposal.id:null});e.setState(_(_({},e.state),{},{change_to:JSON.stringify(n)}),(function(){e.checkButtonStatus()}))}})})]})}}},{key:"render",value:function(){var e=this,t=this.props.proposal;if(!t||!t.id)return null;var n=this.state,s=n.buttonDisabled,i=n.additional_notes;return Object(r.jsx)("section",{id:"app-proposal-change-form-section",children:Object(r.jsxs)("form",{method:"POST",action:"",onSubmit:this.submitChange,children:[Object(r.jsxs)("div",{id:"app-single-proposal-formTitle",children:[Object(r.jsx)("label",{children:"Suggest a Change"}),Object(r.jsx)(f.a,{size:16})]}),Object(r.jsx)("div",{className:"c-form-row what-section",children:this.renderWhatSectionDropdown()}),this.renderCurrentSubmission(),this.renderChangeTo(),Object(r.jsxs)("div",{className:"c-form-row",children:[Object(r.jsx)("label",{children:"Additional Notes/References"}),Object(r.jsx)("textarea",{onKeyDown:function(t){return e.handleKeyDown(t)},value:i,onChange:function(t){return e.inputField(t,"additional_notes")}})]}),Object(r.jsxs)("div",{id:"c-form-buttons",children:[Object(r.jsx)("button",{type:"submit",className:"btn btn-primary-outline less-small",disabled:s,children:"Propose Change"}),Object(r.jsx)("button",{type:"button",className:"btn btn-danger-outline less-small",onClick:this.closeForm,children:"Cancel"})]})]})})}}]),n}(p.Component),N=Object(d.b)((function(e){return{authUser:e.global.authUser}}))(k),S=n("fDsS"),P=n("9qeg"),C=n("e+cM");n("iBnM");function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var s=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var I=function(e){Object(a.a)(n,e);var t=E(n);function n(e){var r;return Object(s.a)(this,n),r=t.call(this,e),Object(u.a)(Object(o.a)(r),"cancelForm",(function(){r.setState({showForm:!1})})),Object(u.a)(Object(o.a)(r),"showForm",(function(){r.setState({showForm:!0})})),Object(u.a)(Object(o.a)(r),"handleRefreshLogs",(function(){r.setState(F(F({},r.state),{},{isShowLogs:!1})),setTimeout((function(){r.setState(F(F({},r.state),{},{isShowLogs:!0}))}),200)})),r.state={proposal:{},proposalId:0,loading:!1,showForm:!1,isShowLogs:!0},r}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.proposalId;this.setState({proposalId:t},(function(){e.getProposal()}))}},{key:"componentDidUpdate",value:function(e){this.props.startInformalAdmin&&this.props.startInformalAdmin!==e.startInformalAdmin&&(this.props.dispatch(Object(h.yb)(!1)),this.getProposal())}},{key:"getProposal",value:function(){var e=this,t=this.state.proposalId;this.props.dispatch(Object(j.Ib)(t,(function(){e.setState({loading:!0}),e.props.dispatch(Object(h.wb)())}),(function(n){var r=n.proposal||{};r.milestones=r.milestones.map((function(e){return F(F({},e),{},{checked:!0})})),e.setState({loading:!1,proposalId:t,proposal:r}),e.props.dispatch(Object(h.P)())})))}},{key:"renderHeader",value:function(){var e=this.props.authUser,t=this.state.proposal;if(!e||!e.id||!t||!t.id)return null;var n=t.title;if(e.is_admin&&"pending"==t.status){if("grant"==t.type)return Object(r.jsx)(C.h,{title:n,buttonData:{link:"/app/proposal/".concat(t.id,"/edit"),text:"Edit Proposal"}});if("simple"==t.type)return Object(r.jsx)(C.h,{title:n,buttonData:{link:"/app/simple-proposal/".concat(t.id,"/edit"),text:"Edit Simple Proposal"}})}return Object(r.jsx)(C.h,{title:n})}},{key:"renderDetail",value:function(){var e=this.state.proposal;return Object(r.jsx)(m.a,{proposal:e,refreshLogs:this.handleRefreshLogs,allowEdit:!0})}},{key:"renderChangeContent",value:function(){var e=this.state,t=e.showForm,n=e.proposal;return t?Object(r.jsx)(N,{proposal:n,onClose:this.cancelForm}):this.state.isShowLogs&&Object(r.jsx)(S.a,{proposal:n,onShow:this.showForm})}},{key:"render",value:function(){var e=this,t=this.props.authUser,n=this.state,s=n.loading,i=n.proposal;if(!t||!t.id||s)return null;if(!i||!i.id)return Object(r.jsx)("div",{children:"We can't find any details"});if(t.is_admin);else if(t.is_member){if(t.id==i.user_id);else if("approved"!=i.status&&"completed"!=i.status)return Object(r.jsx)(b.a,{to:"/app"})}else if(t.id==i.user_id);else if("approved"!=i.status&&"completed"!=i.status)return Object(r.jsx)(b.a,{to:"/app"});return Object(r.jsxs)("div",{id:"app-single-proposal-page",children:[this.renderHeader(),Object(r.jsx)(P.a,{proposal:i,onRefresh:function(){return e.getProposal()}}),this.renderDetail(),this.renderChangeContent()]})}}]),n}(p.Component);t.default=Object(d.b)((function(e){return{authUser:e.global.authUser,settings:e.global.settings,startInformalAdmin:e.admin.startInformalAdmin}}))(Object(b.g)(I))}}]);
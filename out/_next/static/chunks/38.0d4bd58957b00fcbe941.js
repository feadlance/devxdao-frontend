(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[38],{qSTb:function(e,t,s){"use strict";s.r(t);var c=s("nKUr"),i=s("1OyB"),r=s("vuIU"),n=s("JX7q"),a=s("Ji7U"),o=s("md7G"),l=s("foSv"),d=s("rePB"),j=s("q1tI"),h=s("/MKj"),b=s("Ty5D"),p=s("s/m+"),u=s("ZpDd"),m=s("LADp"),O=(s("T89c"),s("e+cM")),f=s("yzbm"),v=s("wHH0"),x=s("uGH+");function y(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,c)}return s}function w(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?y(Object(s),!0).forEach((function(t){Object(d.a)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):y(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,c=Object(l.a)(e);if(t){var i=Object(l.a)(this).constructor;s=Reflect.construct(c,arguments,i)}else s=c.apply(this,arguments);return Object(o.a)(this,s)}}var N=function(e){Object(a.a)(s,e);var t=g(s);function s(e){var c;return Object(i.a)(this,s),c=t.call(this,e),Object(d.a)(Object(n.a)(c),"openRejectionDialog",(function(){c.props.dispatch(Object(u.Z)("milestone-rejection",{milestoneId:c.state.id}))})),Object(d.a)(Object(n.a)(c),"setNotes",(function(e){var t=c.state.noteForm;t.notes=e,c.setState({noteForm:t})})),Object(d.a)(Object(n.a)(c),"delivery",(function(){c.setState({reviewDelivery:!0})})),c.state={id:null,data:{},reviewDelivery:!1,noteForm:{notes:"",files:[]}},c}return Object(r.a)(s,[{key:"componentDidMount",value:function(){var e=this.props.match.params,t=e.id;this.setState({id:t}),this.getDetail(e.id)}},{key:"getDetail",value:function(e){var t=this;this.props.dispatch(Object(m.Xb)(e,(function(){}),(function(s){if(s.success){var c=s.milestoneReview,i=c.milestones.findIndex((function(t){return+t.id===+e}));c.milestoneIndex=i+1,t.setState({data:c})}})))}},{key:"doApprove",value:function(){var e=this,t=this.props.history,s=this.state.noteForm,c={notes:s.notes,file:s.files[0]};this.props.dispatch(Object(m.k)(this.state.id,c,(function(){e.props.dispatch(Object(u.Cb)())}),(function(s){e.props.dispatch(Object(u.U)()),s.success&&(e.props.dispatch(Object(u.Bb)("You've successfully approved this milestone","success")),t.push("/app/milestones"))})))}},{key:"appendFiles",value:function(e){var t=this.state.noteForm;t.files=t.files.concat(e),this.setState({noteForm:t})}},{key:"removeFile",value:function(e){var t=this.state.noteForm;t.files.splice(e,1),this.setState({noteForm:t})}},{key:"renderFiles",value:function(){var e=this,t=this.state.noteForm.files;if(!t||!t.length)return null;var s=[];return t.forEach((function(t,i){s.push(Object(c.jsxs)("li",{children:[Object(c.jsx)("p",{children:t.name||t}),Object(c.jsx)(v.a,{onClick:function(){return e.removeFile(i)}})]},"file_".concat(i)))})),Object(c.jsxs)("div",{id:"files-wrap",children:[Object(c.jsx)("label",{children:Object(c.jsx)("b",{children:"Files:"})}),Object(c.jsx)("ul",{children:s})]})}},{key:"render",value:function(){var e,t=this,s=this.props.authUser,i=this.state,r=i.data,n=i.noteForm;return s&&s.id?s.is_admin?Object(c.jsx)("div",{id:"milestones-page",className:"h-100",children:Object(c.jsxs)(p.Fade,{distance:"20px",bottom:!0,duration:300,delay:600,children:[Object(c.jsx)(O.m,{title:"Milestones review for ".concat(r.proposal_id,"-").concat(r.milestoneIndex)}),Object(c.jsx)("section",{className:"app-infinite-box pb-5 pr-4",children:Object(c.jsxs)("div",{className:"pt-5 pl-5",children:[Object(c.jsx)("h4",{className:"pb-3",children:"Summary"}),Object(c.jsx)("div",{children:Object(c.jsx)("table",{children:Object(c.jsxs)("tbody",{children:[Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"pr-2",children:"Times submitted:"}),Object(c.jsx)("td",{children:r.time_submit})]}),Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"pr-2",children:"OP Email:"}),Object(c.jsx)("td",{children:r.email})]}),Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"pr-2",children:"Proposal number:"}),Object(c.jsx)("td",{children:r.proposal_id})]}),Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"pr-2",children:"Proposal title:"}),Object(c.jsx)("td",{children:r.proposal_title})]}),Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"pr-2",children:"Proposal status:"}),Object(c.jsx)("td",{children:r.proposal_status})]}),Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"pr-2",children:"Milestones in this proposal:"}),Object(c.jsx)("td",{children:null===(e=r.milestones)||void 0===e?void 0:e.length})]})]})})}),Object(c.jsx)("h4",{className:"pt-5 pb-3",children:"User submission"}),Object(c.jsxs)("div",{className:"pb-5",children:[Object(c.jsxs)("div",{className:"c-form-row",children:[Object(c.jsx)("label",{children:"Title of Milestone"}),Object(c.jsx)("p",{className:"font-weight-700",children:r.title})]}),Object(c.jsxs)("div",{className:"c-form-row",children:[Object(c.jsx)("label",{children:"Show details of what will be delivered"}),Object(c.jsx)("p",{className:"font-weight-700",children:r.details})]}),Object(c.jsxs)("div",{className:"c-form-row",children:[Object(c.jsx)("label",{children:"Show acceptance criteria"}),Object(c.jsx)("p",{className:"font-weight-700",children:r.criteria})]}),Object(c.jsxs)("div",{className:"c-form-row",children:[Object(c.jsx)("label",{children:"Grant portion released"}),Object(c.jsx)("p",{className:"font-weight-700",children:r.grant})]}),Object(c.jsxs)("div",{className:"c-form-row",children:[Object(c.jsx)("label",{children:"Please enter the URL of the repository or drive where the completed work has been made available."}),Object(c.jsx)("p",{className:"font-weight-700",children:r.url})]}),Object(c.jsxs)("div",{className:"c-form-row",children:[Object(c.jsx)("label",{children:"Please provide comments and notes regarding the completion of the work. If this is the second or further submission of this milestone, please explain what changes you have made since the last submission."}),Object(c.jsx)("p",{className:"font-weight-700 text-pre-wrap",children:r.comment})]})]}),this.state.reviewDelivery&&Object(c.jsxs)("div",{className:"pb-5",children:[Object(c.jsx)("p",{className:"mb-2",children:"Reviewer - If you are ready to approve this milestone for voting add your review notes here summarizing why this is ready:"}),Object(c.jsx)("textarea",{className:"mb-3",placeholder:"Add notes here (mandatory)",rows:"7",value:this.state.noteForm.message,onChange:function(e){return t.setNotes(e.target.value)}}),Object(c.jsx)(f.a,{accept:"application/pdf",onDrop:function(e){return t.appendFiles(e)},children:function(e){var t=e.getRootProps,s=e.getInputProps;return Object(c.jsx)("section",{id:"c-dropzone",children:Object(c.jsxs)("div",w(w({},t()),{},{children:[Object(c.jsx)("input",w({},s())),Object(c.jsx)(x.a,{color:"#9B64E6"}),Object(c.jsx)("p",{className:"color-primary",children:"Add Files"})]}))})}}),Object(c.jsx)("div",{className:"pt-3",children:this.renderFiles()})]}),Object(c.jsxs)("div",{className:"text-right",children:[!this.state.reviewDelivery&&Object(c.jsx)("button",{className:"btn btn-primary",onClick:function(){return t.delivery()},children:"Review delivery"}),this.state.reviewDelivery&&Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("button",{className:"btn btn-white-outline mr-3",onClick:this.openRejectionDialog,children:"Deny and email message"}),Object(c.jsx)("button",{className:"btn btn-primary",onClick:function(){return t.doApprove()},disabled:!n.notes,children:"Approve and start vote"})]})]})]})})]})}):Object(c.jsx)(b.a,{to:"/"}):null}}]),s}(j.Component);t.default=Object(h.b)((function(e){return{authUser:e.global.authUser}}))(Object(b.g)(N))}}]);
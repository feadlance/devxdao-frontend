(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[53],{TjHA:function(e,t,c){"use strict";c.r(t);var s=c("nKUr"),i=c("1OyB"),n=c("vuIU"),a=c("JX7q"),r=c("Ji7U"),l=c("md7G"),o=c("foSv"),d=c("rePB"),u=c("q1tI"),h=c("/MKj"),j=c("Ty5D"),p=c("55Ip"),b=c("s/m+"),v=c("e+cM"),f=(c("B7S4"),c("KQm4")),m=c("wd/R"),O=c.n(m),x=c("LADp"),y=(c("GsS2"),c("ZpDd")),g=c("YW6W");function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var c,s=Object(o.a)(e);if(t){var i=Object(o.a)(this).constructor;c=Reflect.construct(s,arguments,i)}else c=s.apply(this,arguments);return Object(l.a)(this,c)}}var _=function(e){Object(r.a)(c,e);var t=N(c);function c(e){var s;return Object(i.a)(this,c),s=t.call(this,e),Object(d.a)(Object(a.a)(s),"trackScroll",(function(){s.$elem&&s.$elem.scrollTop+s.$elem.clientHeight>=s.$elem.scrollHeight&&s.runNextPage()})),Object(d.a)(Object(a.a)(s),"openListSurveyVotersModal",(function(e,t,c){e&&s.props.dispatch(Object(y.X)("list-survey-voters",{surveyId:s.props.id,proposal_id:t,place_choice:c}))})),Object(d.a)(Object(a.a)(s),"handleSearch",(function(e){s.setState({search:e.target.value},(function(){s.timer&&(clearTimeout(s.timer),s.timer=null),s.timer=setTimeout((function(){s.reloadTable()}),500)}))})),s.state={loading:!1,data:[],sort_key:"",sort_direction:"desc",search:"",page_id:1,calling:!1,finished:!1},s.$elem=null,s.timer=null,s}return Object(n.a)(c,[{key:"componentDidMount",value:function(){var e=this.props.authUser;e&&e.id&&this.startTracking(),this.getData()}},{key:"componentWillUnmount",value:function(){this.$elem&&this.$elem.removeEventListener("scroll",this.trackScroll)}},{key:"componentDidUpdate",value:function(e){var t=this.props.authUser;e.authUser&&e.authUser.id||!t||!t.id||this.startTracking()}},{key:"startTracking",value:function(){this.$elem=document.getElementById("current-votes-scroll-track"),this.$elem&&this.$elem.addEventListener("scroll",this.trackScroll)}},{key:"runNextPage",value:function(){var e=this,t=this.state,c=t.calling,s=t.loading,i=t.finished,n=t.page_id;c||s||i||this.setState({page_id:n+1},(function(){e.getData(!1)}))}},{key:"getData",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=this.state,s=c.calling,i=c.loading,n=c.finished,a=c.sort_key,r=c.sort_direction,l=c.search,o=c.page_id,d=c.data;if(!(i||s||n)){var u={sort_key:a,sort_direction:r,search:l,page_id:o,limit:10};this.props.dispatch(Object(x.Xb)(this.props.id,u,(function(){t?e.setState({loading:!0,calling:!0}):e.setState({loading:!1,calling:!0})}),(function(t){var c=t.proposals||[],s=t.finished||!1;e.setState({loading:!1,calling:!1,finished:s,data:[].concat(Object(f.a)(d),Object(f.a)(c))})})))}}},{key:"reloadTable",value:function(){var e=this;this.setState({page_id:1,data:[],finished:!1},(function(){e.getData()}))}},{key:"renderTriangle",value:function(e){var t=this.state,c=t.sort_key,i=t.sort_direction;return c!=e?Object(s.jsx)("span",{className:"inactive",children:"\u25b2"}):"asc"==i?Object(s.jsx)("span",{children:"\u25b2"}):Object(s.jsx)("span",{children:"\u25bc"})}},{key:"clickHeader",value:function(e){var t=this,c=this.state,s=c.sort_key,i=c.sort_direction;s==e?i="asc"==i?"desc":"asc":(s=e,i="desc"),this.setState({sort_key:s,sort_direction:i},(function(){t.reloadTable()}))}},{key:"renderResult",value:function(){var e=this,t=this.state.data,c=this.props.cols,i=[];return t&&t.length?(t.forEach((function(t){i.push(Object(s.jsx)("li",{children:Object(s.jsxs)("div",{className:"infinite-row align-items-center d-flex py-3 font-size-14 font-weight-700",children:[Object(s.jsx)("div",{className:"c-col-1 c-cols",children:Object(s.jsx)(p.b,{to:"/app/proposal/".concat(t.id),children:Object(s.jsx)("p",{children:t.id})})}),Object(s.jsx)("div",{className:"c-col-2 c-cols",children:Object(s.jsx)("p",{children:O()(t.created_at).local().format("M/D/YYYY")})}),Object(s.jsx)("div",{className:"c-col-3 c-cols",children:Object(s.jsx)("p",{children:t.title})}),Object(s.jsx)("div",{className:"c-col-custom c-cols text-center",style:{width:"calc(".concat(55,"% / ").concat(c+1,")")},children:Object(s.jsx)("a",{className:"px-3",onClick:function(){return e.openListSurveyVotersModal(t.total_vote,t.id)},children:t.total_vote})}),Array(c).fill(1).map((function(i,n){return Object(s.jsx)("div",{className:"c-col-custom c-cols text-center",style:{width:"calc(".concat(55,"% / ").concat(c+1,")")},children:Object(s.jsx)("a",{className:"px-3",onClick:function(){return e.openListSurveyVotersModal(t["".concat(n+1,"_place")],t.id,1)},children:t["".concat(n+1,"_place")]})},n)}))]})},"mile_".concat(t.id)))})),Object(s.jsx)("ul",{children:i})):Object(s.jsx)("div",{id:"infinite-no-result",children:Object(s.jsx)("label",{className:"font-size-14",children:"No Results Found"})})}},{key:"render",value:function(){var e=this,t=this.state,c=t.loading,i=t.search,n=this.props.cols;return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{className:"app-infinite-search-wrap",children:[Object(s.jsx)("h4",{children:"Current votes by proposal"}),Object(s.jsx)("input",{type:"text",value:i,onChange:this.handleSearch,placeholder:"Search..."})]}),Object(s.jsx)("div",{className:"survey-votes-table infinite-content ".concat(this.props.hideWonColumn?"hide-won-column":""),children:Object(s.jsxs)("div",{className:"infinite-contentInner",children:[Object(s.jsx)("div",{className:"infinite-header",children:Object(s.jsxs)("div",{className:"infinite-headerInner",children:[Object(s.jsx)("div",{className:"c-col-1 c-cols",children:Object(s.jsx)("label",{className:"font-size-14",children:"Proposal number"})}),Object(s.jsx)("div",{className:"c-col-2 c-cols",children:Object(s.jsx)("label",{className:"font-size-14",children:"Date discussion started"})}),Object(s.jsx)("div",{className:"c-col-3 c-cols",children:Object(s.jsx)("label",{className:"font-size-14",children:"Proposal title"})}),Object(s.jsxs)("div",{className:"c-col-custom c-cols",style:{width:"calc(".concat(55,"% / ").concat(n+1,")")},onClick:function(){return e.clickHeader("total_vote")},children:[Object(s.jsx)("label",{className:"font-size-14",children:"Total votes"}),this.renderTriangle("total_vote")]}),Array(n).fill(1).map((function(t,c){return Object(s.jsxs)("div",{className:"c-col-custom c-cols",style:{width:"calc(".concat(55,"% / ").concat(n+1,")")},onClick:function(){return e.clickHeader("".concat(c+1,"_place"))},children:[Object(s.jsxs)("label",{className:"font-size-14",children:[g.a.ordinalSuffixOf(c+1)," place"]}),e.renderTriangle("".concat(c+1,"_place"))]},c)}))]})}),Object(s.jsx)("div",{className:"infinite-body",id:"current-votes-scroll-track",children:c?Object(s.jsx)(v.g,{}):this.renderResult()})]})})]})}}]),c}(u.Component),k=Object(h.b)((function(e){return{authUser:e.global.authUser}}))(_),S=c("xzuf");function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var c,s=Object(o.a)(e);if(t){var i=Object(o.a)(this).constructor;c=Reflect.construct(s,arguments,i)}else c=s.apply(this,arguments);return Object(l.a)(this,c)}}var D=function(e){Object(r.a)(c,e);var t=w(c);function c(e){var s;return Object(i.a)(this,c),s=t.call(this,e),Object(d.a)(Object(a.a)(s),"showAnswer",(function(){var e=s.state,t=e.currentVoter,c=e.surveyId,i=e.voters.find((function(e){return+e.user_id===+t}));s.props.dispatch(Object(y.X)("show-survey-voter-answer",{surveyId:c,user:i}))})),Object(d.a)(Object(a.a)(s),"sendReminder",(function(){s.props.dispatch(Object(x.xc)(s.state.surveyId,(function(){s.props.dispatch(Object(y.Ab)())}),(function(e){s.props.dispatch(Object(y.T)()),e.success&&s.props.dispatch(Object(y.zb)("Send reminder successfully!","success"))})))})),s.state={surveyId:null,surveyData:null,voters:[],unvotedUsers:[],currentVoter:""},s}return Object(n.a)(c,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.id;this.setState({surveyId:t}),this.props.dispatch(Object(x.Ub)(t,(function(){}),(function(t){t.success&&e.setState({surveyData:t.survey})}))),this.props.dispatch(Object(x.Wb)(t,{limit:9999},(function(){}),(function(t){t.success&&e.setState({voters:t.users})}))),this.props.dispatch(Object(x.Zb)(t,{limit:9999},(function(){}),(function(t){t.success&&e.setState({unvotedUsers:t.users})})))}},{key:"render",value:function(){var e=this,t=this.props.authUser,c=this.state,i=c.surveyData,n=c.surveyId,a=c.voters,r=c.unvotedUsers,l=c.currentVoter;return t&&t.id?t.is_admin?Object(s.jsx)("div",{id:"survey-detail-page",className:"h-100",children:Object(s.jsxs)(b.Fade,{distance:"20px",bottom:!0,duration:300,delay:600,children:[Object(s.jsx)(v.i,{title:""}),Object(s.jsxs)("section",{className:"app-infinite-box mb-4",children:[Object(s.jsx)("div",{className:"app-infinite-search-wrap",children:Object(s.jsxs)("h4",{children:["Survey S",null===i||void 0===i?void 0:i.id]})}),Object(s.jsxs)("div",{className:"pb-3 pl-5 pr-3",children:[Object(s.jsxs)("div",{children:[Object(s.jsx)("span",{children:"Status: "}),Object(s.jsx)("b",{className:"text-capitalize",children:null===i||void 0===i?void 0:i.status})]}),"active"===(null===i||void 0===i?void 0:i.status)&&Object(s.jsxs)("div",{className:"flex",children:[Object(s.jsx)("span",{children:"Time left: "}),Object(s.jsx)("b",{className:"d-inline-block",children:Object(s.jsx)(S.a,{lastTime:O()(null===i||void 0===i?void 0:i.end_time)})})]}),Object(s.jsxs)("div",{children:[Object(s.jsx)("span",{children:"Submissions complete:"})," ",Object(s.jsxs)("b",{children:[null===i||void 0===i?void 0:i.user_responded," out of ",null===i||void 0===i?void 0:i.total_member]})]})]}),"completed"===(null===i||void 0===i?void 0:i.status)&&Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("div",{className:"app-infinite-search-wrap",children:Object(s.jsx)("h4",{children:"Winners"})}),Object(s.jsx)("div",{className:"pb-3 pl-5 pr-3",children:Object(s.jsx)("ul",{children:null===i||void 0===i?void 0:i.survey_ranks.filter((function(e){return e.is_winner})).map((function(e){var t,c;return Object(s.jsxs)("li",{className:"py-2",children:[g.a.ordinalSuffixOf(e.rank)," Place -"," ",Object(s.jsx)(p.b,{to:"/app/proposal/".concat(null===(t=e.proposal)||void 0===t?void 0:t.id),children:Object(s.jsx)("b",{children:null===(c=e.proposal)||void 0===c?void 0:c.title})})]},e.id)}))})})]}),n&&Object(s.jsx)(k,{id:n,cols:null===i||void 0===i?void 0:i.number_response}),Object(s.jsx)("div",{className:"app-infinite-search-wrap",children:Object(s.jsx)("h4",{children:"View survey responses by user"})}),Object(s.jsxs)("div",{className:"c-form-row pb-3 pl-5 pr-3",children:[Object(s.jsx)("label",{children:"Select number of responses needed"}),Object(s.jsxs)("div",{className:"d-flex",children:[Object(s.jsxs)("select",{value:l,onChange:function(t){return e.setState({currentVoter:t.target.value})},children:[Object(s.jsx)("option",{value:"",disabled:!0,children:"Select voter"}),a.map((function(e,t){return Object(s.jsx)("option",{value:e.user_id,children:e.email},"option1_".concat(t))}))]}),Object(s.jsx)("button",{disabled:!l,className:"ml-3 btn btn-primary small",onClick:this.showAnswer,children:"Go"})]})]}),"active"===(null===i||void 0===i?void 0:i.status)&&Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("div",{className:"app-infinite-search-wrap",children:Object(s.jsx)("h4",{children:"Users who have not yet submitted survey"})}),Object(s.jsxs)("div",{className:"pb-3 pl-5 pr-3",children:[Object(s.jsx)("ul",{children:r.map((function(e){return Object(s.jsx)("li",{className:"py-2",children:e.email},e.id)}))}),Object(s.jsx)("button",{className:"mt-5 btn btn-primary less-small",onClick:this.sendReminder,disabled:0===r.length,children:"Send reminder"})]})]})]})]})}):Object(s.jsx)(j.a,{to:"/"}):null}}]),c}(u.Component);t.default=Object(h.b)((function(e){return{authUser:e.global.authUser}}))(Object(j.g)(D))}}]);
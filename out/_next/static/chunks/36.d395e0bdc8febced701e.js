(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[36],{CuFn:function(e,t,c){"use strict";c.r(t);var i=c("nKUr"),s=c("1OyB"),n=c("vuIU"),r=c("JX7q"),l=c("Ji7U"),a=c("md7G"),o=c("foSv"),d=c("rePB"),j=c("q1tI"),h=c("/MKj"),u=c("Ty5D"),b=c("s/m+"),p=c("e+cM"),O=c("LADp"),f=c("KQm4"),m=c("wd/R"),v=c.n(m);c("hUgm");function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var c,i=Object(o.a)(e);if(t){var s=Object(o.a)(this).constructor;c=Reflect.construct(i,arguments,s)}else c=i.apply(this,arguments);return Object(a.a)(this,c)}}var g=function(e){Object(l.a)(c,e);var t=x(c);function c(e){var i;return Object(s.a)(this,c),i=t.call(this,e),Object(d.a)(Object(r.a)(i),"trackScroll",(function(){i.$elem&&i.$elem.scrollTop+i.$elem.clientHeight>=i.$elem.scrollHeight&&i.runNextPage()})),i.state={loading:!1,data:[],sort_key:"",sort_direction:"desc",search:"",page_id:1,calling:!1,finished:!1},i.$elem=null,i.timer=null,i}return Object(n.a)(c,[{key:"componentDidMount",value:function(){var e=this.props.authUser;e&&e.id&&this.startTracking(),this.getData()}},{key:"componentWillUnmount",value:function(){this.$elem&&this.$elem.removeEventListener("scroll",this.trackScroll)}},{key:"componentDidUpdate",value:function(e){var t=this.props.authUser;e.authUser&&e.authUser.id||!t||!t.id||this.startTracking()}},{key:"startTracking",value:function(){this.$elem=document.getElementById("logs-scroll-track"),this.$elem&&this.$elem.addEventListener("scroll",this.trackScroll)}},{key:"runNextPage",value:function(){var e=this,t=this.state,c=t.calling,i=t.loading,s=t.finished,n=t.page_id;c||i||s||this.setState({page_id:n+1},(function(){e.getData(!1)}))}},{key:"getData",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=this.state,i=c.calling,s=c.loading,n=c.finished,r=c.sort_key,l=c.sort_direction,a=c.search,o=c.page_id,d=c.data;if(!(s||i||n)){var j={sort_key:r,sort_direction:l,search:a,page_id:o,limit:20};this.props.dispatch(Object(O.qb)(this.props.id,j,(function(){t?e.setState({loading:!0,calling:!0}):e.setState({loading:!1,calling:!0})}),(function(t){var c=t.milestoneLogs||[],i=t.finished||!1;e.setState({loading:!1,calling:!1,finished:i,data:[].concat(Object(f.a)(d),Object(f.a)(c))})})))}}},{key:"renderMilestoneIndex",value:function(e){var t=e.milestones.findIndex((function(t){return t.id===e.milestone_id}));return Object(i.jsxs)("p",{className:"pl-3",children:[t+1,"/",e.milestones.length]})}},{key:"renderResult",value:function(){var e=this.state.data,t=[];return e&&e.length?(e.forEach((function(e){t.push(Object(i.jsx)("li",{children:Object(i.jsxs)("div",{className:"infinite-row align-items-center d-flex py-3 font-size-14 font-weight-700",children:[Object(i.jsx)("div",{className:"c-col-1 c-cols",children:Object(i.jsx)("p",{children:v()(e.created_at).local().format("M/D/YYYY")})}),Object(i.jsx)("div",{className:"c-col-2 c-cols",children:Object(i.jsx)("p",{children:e.email})}),Object(i.jsx)("div",{className:"c-col-3 c-cols",children:Object(i.jsx)("p",{children:e.action})})]})},"mile_".concat(e.id)))})),Object(i.jsx)("ul",{children:t})):Object(i.jsx)("div",{id:"infinite-no-result",children:Object(i.jsx)("label",{className:"font-size-14",children:"No Results Found"})})}},{key:"render",value:function(){var e=this.state.loading;return Object(i.jsx)("div",{className:"activity-logs-table infinite-content",children:Object(i.jsxs)("div",{className:"infinite-contentInner",children:[Object(i.jsx)("div",{className:"infinite-header",children:Object(i.jsxs)("div",{className:"infinite-headerInner",children:[Object(i.jsx)("div",{className:"c-col-1 c-cols",children:Object(i.jsx)("label",{className:"font-size-14",children:"Date and time"})}),Object(i.jsx)("div",{className:"c-col-2 c-cols",children:Object(i.jsx)("label",{className:"font-size-14",children:"User"})}),Object(i.jsx)("div",{className:"c-col-3 c-cols",children:Object(i.jsx)("label",{className:"font-size-14",children:"Action"})})]})}),Object(i.jsx)("div",{className:"infinite-body",id:"logs-scroll-track",children:e?Object(i.jsx)(p.f,{}):this.renderResult()})]})})}}]),c}(j.Component),y=Object(h.b)((function(e){return{authUser:e.global.authUser}}))(g),N=c("ZpDd");function _(e,t){var c=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),c.push.apply(c,i)}return c}function k(e){for(var t=1;t<arguments.length;t++){var c=null!=arguments[t]?arguments[t]:{};t%2?_(Object(c),!0).forEach((function(t){Object(d.a)(e,t,c[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(c)):_(Object(c)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(c,t))}))}return e}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var c,i=Object(o.a)(e);if(t){var s=Object(o.a)(this).constructor;c=Reflect.construct(i,arguments,s)}else c=i.apply(this,arguments);return Object(a.a)(this,c)}}var S=function(e){Object(l.a)(c,e);var t=w(c);function c(e){var i;return Object(s.a)(this,c),i=t.call(this,e),Object(d.a)(Object(r.a)(i),"togglePaid",(function(e){var t=i.state.data;t.paid=!t.paid,i.setState({data:k({},t)}),i.props.dispatch(Object(O.Ac)(i.state.id,e?1:0,(function(){}),(function(e){e.success&&(i.setState({isShow:!1}),i.props.dispatch(Object(N.vb)("You've successfully update paid status of this milestone","success")),setTimeout((function(){i.setState({isShow:!0})}),100))})))})),i.state={id:null,data:{},isShow:!0,currentMilestone:null},i}return Object(n.a)(c,[{key:"componentDidMount",value:function(){var e=this.props.match.params,t=e.id;this.setState({id:t}),this.getDetail(e.id)}},{key:"getDetail",value:function(e){var t=this;this.props.dispatch(Object(O.pb)(e,(function(){}),(function(c){if(c.success){var i=c.milestone,s=i.milestones.findIndex((function(t){return+t.id===+e}));i.milestoneIndex=s+1,t.setState({data:i,currentMilestone:i.milestones[s]})}})))}},{key:"render",value:function(){var e,t,c=this,s=this.props.authUser,n=this.state,r=n.data,l=n.currentMilestone,a=n.id,o=n.isShow;return s&&s.id?s.is_admin?Object(i.jsx)("div",{id:"milestones-page",className:"h-100",children:Object(i.jsxs)(b.Fade,{distance:"20px",bottom:!0,duration:300,delay:600,children:[Object(i.jsx)(p.h,{title:"Milestones log for ".concat(r.proposal_id,"-").concat(r.milestoneIndex)}),Object(i.jsxs)("section",{className:"app-infinite-box mb-4",children:[Object(i.jsxs)("div",{className:"app-infinite-search-wrap",children:[Object(i.jsx)("h4",{children:"Summary"}),Object(i.jsx)(p.j,{value:!!r.paid,onChange:function(e){return c.togglePaid(e.target.checked)},labelRight:"paid",labelLeft:"unpaid"})]}),Object(i.jsx)("div",{className:"pl-5",children:Object(i.jsx)("div",{children:Object(i.jsx)("table",{children:Object(i.jsxs)("tbody",{children:[Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Milestone status:"}),Object(i.jsx)("td",{children:r.submitted_time?"Submitted":"Not submitted"})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2 pb-2",children:"Paid?:"}),Object(i.jsx)("td",{children:r.paid?"Yes":"No"})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"OP email:"}),Object(i.jsx)("td",{children:r.email})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Proposal number:"}),Object(i.jsx)("td",{children:r.proposal_id})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Proposal title:"}),Object(i.jsx)("td",{children:r.proposal_title})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Proposal status:"}),Object(i.jsx)("td",{children:r.proposal_status})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Milestones in this proposal:"}),Object(i.jsx)("td",{children:null===(e=r.milestones)||void 0===e?void 0:e.length})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Milestone title:"}),Object(i.jsx)("td",{children:null===l||void 0===l?void 0:l.title})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Acceptance criteria:"}),Object(i.jsx)("td",{children:null===l||void 0===l?void 0:l.criteria})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"OP milestone submission URL:"}),Object(i.jsx)("td",{children:null===l||void 0===l?void 0:l.url})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"OP milestone submission notes:"}),Object(i.jsx)("td",{children:null===l||void 0===l?void 0:l.comment})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Grant portion:"}),Object(i.jsx)("td",{children:null===l||void 0===l?void 0:l.grant})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Code reviewer:"}),Object(i.jsx)("td",{children:null===r||void 0===r?void 0:r.admin_reviewer_email})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Review date:"}),Object(i.jsx)("td",{children:v()(null===l||void 0===l?void 0:l.reviewed_at).format("M/D/YYYY")})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Reviewer notes:"}),Object(i.jsx)("td",{children:null===l||void 0===l?void 0:l.notes})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{className:"pr-2",children:"Reviewer attachments:"}),Object(i.jsx)("td",{children:Object(i.jsx)("a",{className:"text-underline",target:"_blank",href:null===r||void 0===r?void 0:r.support_file_url,rel:"noreferrer",children:null===r||void 0===r||null===(t=r.support_file)||void 0===t?void 0:t.split("/").pop()})})]})]})})})}),Object(i.jsx)("div",{className:"pt-5 app-infinite-search-wrap",children:Object(i.jsx)("h4",{children:"Activity log"})}),Object(i.jsx)("div",{className:"pl-5",children:!!a&&!!o&&Object(i.jsx)(y,{id:a})})]})]})}):Object(i.jsx)(u.a,{to:"/"}):null}}]),c}(j.Component);t.default=Object(h.b)((function(e){return{authUser:e.global.authUser}}))(Object(u.g)(S))}}]);
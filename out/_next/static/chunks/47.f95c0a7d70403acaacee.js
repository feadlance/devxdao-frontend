(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[47],{FvLl:function(e,t,n){"use strict";n.r(t);var s=n("nKUr"),r=n("1OyB"),i=n("vuIU"),o=n("JX7q"),a=n("Ji7U"),c=n("md7G"),l=n("foSv"),u=n("rePB"),p=n("q1tI"),d=n("/MKj"),b=n("Ty5D"),h=n("ZpDd"),j=n("LADp"),m=n("eySl"),f=n("I6fM"),O=n("YW6W"),v=n("J/zA"),g=n("20Bz");n("ltsK");function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=Object(l.a)(e);if(t){var r=Object(l.a)(this).constructor;n=Reflect.construct(s,arguments,r)}else n=s.apply(this,arguments);return Object(c.a)(this,n)}}var y=n("wd/R"),k=function(e){Object(a.a)(n,e);var t=w(n);function n(e){var s;return Object(r.a)(this,n),s=t.call(this,e),Object(u.a)(Object(o.a)(s),"closeForm",(function(e){e.preventDefault();var t=s.props.onClose;t&&t()})),Object(u.a)(Object(o.a)(s),"selectWhatSection",(function(e){var t=s.props.proposal,n=e.target.value,r="",i=null;"short_description"==n?r=t.short_description:"total_grant"==n?r=t.total_grant.toString():"previous_work"==n?r=t.previous_work:"other_work"==n?r=t.other_work:"milestone"==n?(r={milestones:t.milestones,total_grant:t.total_grant},i=t.milestones[0].id):"citation"==n&&(r={citations:t.citations},i=t.citations[0]?t.citations[0].id:null),s.setState({change_to:"",additional_notes:"",what_section:n,current_submission:r,current_submission_id:i},(function(){s.checkButtonStatus()}))})),Object(u.a)(Object(o.a)(s),"selectMilestone",(function(e){s.setState(_(_({},s.state),{},{current_submission_id:e.target.value,change_to:""}),(function(){s.checkButtonStatus()}))})),Object(u.a)(Object(o.a)(s),"selectCitation",(function(e){s.setState(_(_({},s.state),{},{current_submission_id:e.target.value,change_to:""}),(function(){s.checkButtonStatus()}))})),Object(u.a)(Object(o.a)(s),"submitChange",(function(e){e.preventDefault();var t=s.props,n=t.proposal,r=t.onClose,i=s.state,o=i.what_section,a=i.change_to,c=i.additional_notes;if(o.trim())if(a.trim()||"remove_membership"==o)if(c.trim())if("total_grant"!=o||a.trim()&&!(parseFloat(O.a.unformatNumber(a.toString()))<=0)){var l={proposal:n.id,what_section:o,change_to:a,additional_notes:c,grant:0};s.props.dispatch(Object(j.Lc)(l,(function(){s.props.dispatch(Object(h.Cb)())}),(function(e){s.props.dispatch(Object(h.U)()),e.success&&(r&&r(),s.props.dispatch(Object(h.Bb)("You've successfully proposed a change","success")))})))}else s.props.dispatch(Object(h.Bb)("Please input valid total grant amount"));else s.props.dispatch(Object(h.Bb)("Please input additional notes"));else s.props.dispatch(Object(h.Bb)("Please input what change you will make"));else s.props.dispatch(Object(h.Bb)("Please input what section you make a change to"))})),Object(u.a)(Object(o.a)(s),"handleKeyDown",(function(e){if("Tab"==e.key){e.preventDefault();var t=e.target.selectionStart,n=e.target.selectionEnd;e.target.value=e.target.value.substring(0,t)+"\t"+e.target.value.substring(n),e.target.selectionStart=e.target.selectionEnd=t+1}})),s.state={buttonDisabled:!0,what_section:"",change_to:"",additional_notes:"",current_submission:"",current_submission_id:null},s}return Object(i.a)(n,[{key:"inputField",value:function(e,t){var n=this;this.setState(Object(u.a)({},t,e.target.value),(function(){n.checkButtonStatus()}))}},{key:"inputEuroField",value:function(e,t){var n=this,s=e.target.value;s=O.a.unformatPriceNumber(s),isNaN(s)&&(s=""),s=O.a.adjustNumericString(s,2),this.setState(Object(u.a)({},t,s),(function(){n.checkButtonStatus()}))}},{key:"checkCitationsError",value:function(){var e=this.state,t=e.change_to,n=e.current_submission,s=e.current_submission_id;if(!t)return!0;var r=JSON.parse(t),i=0,o=!1;if(r.proposalId&&r.explanation&&""!=r.percentage)if(r.checked&&r.validProposal&&r.proposal&&r.proposal.id){if(s&&"new"!==s)i=n.citations.filter((function(e){return e.id!==s})).reduce((function(e,t){return e+ +t.percentage}),0)+ +r.percentage;else i=n.citations.reduce((function(e,t){return e+ +t.percentage}),0)+ +r.percentage}else o=!0;else o=!0;return!o&&+i>100&&(o=!0),o}},{key:"checkMilestonesError",value:function(){var e=this.state,t=e.change_to,n=e.current_submission,s=e.current_submission_id,r=this.props.proposal;if(!t)return!0;var i=!1;if(!r.total_grant||parseFloat(O.a.unformatNumber(r.total_grant))<=0)i=!0;else{var o=JSON.parse(t);o.title.trim()&&o.details.trim()&&o.criteria.trim()&&o.deadline.trim()&&o.level_difficulty.trim()&&o.checked||(i=!0);var a=n.milestones.filter((function(e){return e.id!==s})).reduce((function(e,t){return e+ +t.grant}),0);r.total_grant<a+ +o.grant&&(i=!0)}return i}},{key:"checkButtonStatus",value:function(){var e=this.state,t=e.what_section,n=e.change_to,s=e.additional_notes,r=!0;("remove_membership"==t.trim()&&s.trim()||"citation"==t.trim()&&!this.checkCitationsError()&&s.trim()||"milestone"==t.trim()&&!this.checkMilestonesError()&&s.trim()||!["milestone","citation","remove_membership"].includes(t)&&n.trim()&&s.trim())&&(r=!1),this.setState(_(_({},this.state),{},{buttonDisabled:r}))}},{key:"renderWhatSectionDropdown",value:function(){var e=this.state.what_section,t=this.props.proposal;return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{className:"d-block mb-20",children:[Object(s.jsx)("label",{className:"mb-12",children:"What Section?"}),Object(s.jsxs)("select",{value:e,onChange:this.selectWhatSection,children:[Object(s.jsx)("option",{value:"",children:"Select..."}),Object(s.jsx)("option",{value:"short_description",children:"Proposal Description"}),"grant"==t.type?Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("option",{value:"total_grant",children:"Grant Total"}),Object(s.jsx)("option",{value:"previous_work",children:"OP's Previous Work"}),Object(s.jsx)("option",{value:"other_work",children:"Other Previous Work"})]}):null,t.include_membership?Object(s.jsx)("option",{value:"remove_membership",children:"Remove Membership"}):null,t.milestones.length>0?Object(s.jsx)("option",{value:"milestone",children:"Milestone"}):null,Object(s.jsx)("option",{value:"citation",children:"Citation"})]})]}),"milestone"===e&&Object(s.jsxs)("div",{className:"d-block mb-20",children:[Object(s.jsx)("label",{className:"mb-12",children:"What Milestone?"}),Object(s.jsx)("select",{value:this.state.current_submission_id,onChange:this.selectMilestone,children:t.milestones.map((function(e,t){return Object(s.jsx)("option",{value:e.id,children:e.title},t)}))})]}),"citation"===e&&Object(s.jsxs)("div",{className:"d-block mb-20",children:[Object(s.jsx)("label",{className:"mb-12",children:"What Citation?"}),Object(s.jsxs)("select",{value:this.state.current_submission_id,onChange:this.selectCitation,children:[t.citations.map((function(e,t){return Object(s.jsxs)("option",{value:e.id,children:["Citation ",t+1]},t)})),Object(s.jsx)("option",{value:"new",children:"+ New Citation"},"new")]})]})]})}},{key:"renderMilestone",value:function(){var e=this.state,t=e.current_submission,n=e.current_submission_id,r=t.milestones.find((function(e){return e.id==n}));return Object(s.jsxs)("div",{children:[Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Title of Milestone (10 word limit)"}),Object(s.jsx)("p",{className:"mb-20",children:r.title}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Details of what will be delivered in milestone"}),Object(s.jsx)("p",{className:"mb-20",children:r.details}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Acceptance criteria: Please enter the specific details on what\n            the deliverable must do to prove this milestone is complete."}),Object(s.jsx)("p",{className:"mb-20",children:r.criteria}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Grant portion requested for this milestone"}),Object(s.jsx)("p",{className:"mb-20",children:O.a.formatPriceNumber(r.grant.toString())}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Deadline"}),Object(s.jsx)("p",{className:"mb-20",children:r.deadline?y(r.deadline).format("M/D/YYYY"):""}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Level of Difficulty"}),Object(s.jsx)("p",{className:"mb-20",children:r.level_difficulty})]},"milestone_".concat(n))}},{key:"renderCitation",value:function(){var e=this.state,t=e.current_submission,n=e.current_submission_id,r=t.citations.find((function(e){return e.id==n}));return Object(s.jsxs)("div",{children:[Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Cited Proposal Number"}),Object(s.jsx)("p",{className:"mb-20",children:r.rep_proposal_id}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Cited Proposal Title"}),Object(s.jsx)("p",{className:"mb-20",children:r.rep_proposal.title}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Cited Proposal OP"}),Object(s.jsx)("p",{className:"mb-20",children:r.rep_proposal.user.profile.forum_name}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"Explain how this work is foundational to your work"}),Object(s.jsx)("p",{className:"mb-20",children:r.explanation}),Object(s.jsx)("label",{className:"font-weight-700 d-block mb-12",children:"% of the rep gained from this proposal do you wish to give to the OP of the prior work"}),Object(s.jsx)("p",{className:"mb-20",children:r.percentage})]})}},{key:"renderCurrentSubmission",value:function(){var e=this.state,t=e.current_submission,n=e.what_section,r=e.current_submission_id;return t?"total_grant"==n?Object(s.jsxs)("div",{className:"c-form-row",children:[Object(s.jsx)("label",{children:"Current Submission"}),Object(s.jsxs)("div",{className:"app-readonly-box",children:[O.a.formatPriceNumber(t)," Euro"]})]}):"milestone"===n?Object(s.jsxs)("div",{className:"c-form-row",children:[Object(s.jsx)("label",{children:"Change From"}),Object(s.jsx)("div",{className:"app-box",children:this.renderMilestone()})]}):"citation"===n?r&&"new"!==r?Object(s.jsxs)("div",{className:"c-form-row",children:[Object(s.jsx)("label",{children:"Change From"}),Object(s.jsx)("div",{className:"app-box",children:this.renderCitation()})]}):Object(s.jsx)(s.Fragment,{}):Object(s.jsxs)("div",{className:"c-form-row",children:[Object(s.jsx)("label",{children:"Current Submission"}),Object(s.jsx)("div",{className:"app-readonly-box",children:t})]}):null}},{key:"renderChangeTo",value:function(){var e=this,t=this.state,n=t.change_to,r=t.what_section,i=t.current_submission,o=t.current_submission_id;if("remove_membership"==r)return null;if(["","short_description","total_grant","previous_work","other_work"].includes(r))return Object(s.jsxs)("div",{className:"c-form-row",children:[Object(s.jsx)("label",{children:"Change to:"}),"total_grant"!=r?Object(s.jsx)("textarea",{value:n,onChange:function(t){return e.inputField(t,"change_to")}}):Object(s.jsxs)("div",{children:[Object(s.jsx)("input",{type:"text",value:O.a.formatPriceNumber(n.toString()),onChange:function(t){return e.inputEuroField(t,"change_to")}}),Object(s.jsx)("label",{children:"Euro"})]})]});if("milestone"===r){var a,c=JSON.parse(JSON.stringify(i.milestones)),l=c.findIndex((function(e){return e.id==o})),u=c[l].grant;return a=n?JSON.parse(n):c[l],Object(s.jsxs)("div",{className:"c-form-row",children:[Object(s.jsx)("label",{children:"Change to:"}),Object(s.jsx)("div",{className:"app-box",children:Object(s.jsx)(v.a,{showAction:!1,total_grant:u,milestones:[a],onUpdate:function(t){e.setState(_(_({},e.state),{},{change_to:JSON.stringify(t[0])}),(function(){e.checkButtonStatus()}))}})})]})}if("citation"===r){var p,d=JSON.parse(JSON.stringify(i.citations)),b=d.findIndex((function(e){return e.id==o}));p=n?JSON.parse(n):d[b];var h=100-i.citations.reduce((function(e,t){return e+ +t.percentage}),0);return o&&"new"!==o&&(h=+h+ +i.citations[b].percentage),Object(s.jsxs)("div",{className:"c-form-row",children:[Object(s.jsx)("label",{children:"Change to:"}),Object(s.jsx)("div",{className:"app-box",children:Object(s.jsx)(g.a,{showAction:!1,checkCustomSum:h,citations:p?[p]:[{proposalId:"",explanation:"",percentage:"",validProposal:!1,checked:!1,proposal:{}}],onUpdate:function(t){var n=_(_({},t[0]),{},{rep_proposal:t[0].proposal,rep_proposal_id:t[0].proposal?t[0].proposal.id:null});e.setState(_(_({},e.state),{},{change_to:JSON.stringify(n)}),(function(){e.checkButtonStatus()}))}})})]})}}},{key:"render",value:function(){var e=this,t=this.props.proposal;if(!t||!t.id)return null;var n=this.state,r=n.buttonDisabled,i=n.additional_notes;return Object(s.jsx)("section",{id:"app-proposal-change-form-section",children:Object(s.jsxs)("form",{method:"POST",action:"",onSubmit:this.submitChange,children:[Object(s.jsxs)("div",{id:"app-single-proposal-formTitle",children:[Object(s.jsx)("label",{children:"Suggest a Change"}),Object(s.jsx)(f.a,{size:16})]}),Object(s.jsx)("div",{className:"c-form-row what-section",children:this.renderWhatSectionDropdown()}),this.renderCurrentSubmission(),this.renderChangeTo(),Object(s.jsxs)("div",{className:"c-form-row",children:[Object(s.jsx)("label",{children:"Additional Notes/References"}),Object(s.jsx)("textarea",{onKeyDown:function(t){return e.handleKeyDown(t)},value:i,onChange:function(t){return e.inputField(t,"additional_notes")}})]}),Object(s.jsxs)("div",{id:"c-form-buttons",children:[Object(s.jsx)("button",{type:"submit",className:"btn btn-primary-outline less-small",disabled:r,children:"Propose Change"}),Object(s.jsx)("button",{type:"button",className:"btn btn-danger-outline less-small",onClick:this.closeForm,children:"Cancel"})]})]})})}}]),n}(p.Component),N=Object(d.b)((function(e){return{authUser:e.global.authUser}}))(k),S=n("fDsS"),C=n("9qeg"),P=n("e+cM");n("iBnM");function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=Object(l.a)(e);if(t){var r=Object(l.a)(this).constructor;n=Reflect.construct(s,arguments,r)}else n=s.apply(this,arguments);return Object(c.a)(this,n)}}var B=function(e){Object(a.a)(n,e);var t=F(n);function n(e){var s;return Object(r.a)(this,n),s=t.call(this,e),Object(u.a)(Object(o.a)(s),"cancelForm",(function(){s.setState({showForm:!1})})),Object(u.a)(Object(o.a)(s),"showForm",(function(){s.setState({showForm:!0})})),Object(u.a)(Object(o.a)(s),"handleRefreshLogs",(function(){s.setState(E(E({},s.state),{},{isShowLogs:!1})),setTimeout((function(){s.setState(E(E({},s.state),{},{isShowLogs:!0}))}),200)})),s.state={proposal:{},proposalId:0,loading:!1,showForm:!1,isShowLogs:!0},s}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.proposalId;this.setState({proposalId:t},(function(){e.getProposal()}))}},{key:"componentDidUpdate",value:function(e){this.props.startInformalAdmin&&this.props.startInformalAdmin!==e.startInformalAdmin&&(this.props.dispatch(Object(h.Eb)(!1)),this.getProposal())}},{key:"getProposal",value:function(){var e=this,t=this.state.proposalId;this.props.dispatch(Object(j.Rb)(t,(function(){e.setState({loading:!0}),e.props.dispatch(Object(h.Cb)())}),(function(n){var s=n.proposal||{};s.milestones=s.milestones.map((function(e){return E(E({},e),{},{checked:!0})})),e.setState({loading:!1,proposalId:t,proposal:s}),e.props.dispatch(Object(h.U)())})))}},{key:"renderHeader",value:function(){var e=this.props.authUser,t=this.state.proposal;if(!e||!e.id||!t||!t.id)return null;var n=t.title;if(e.is_admin&&"pending"==t.status){if("grant"==t.type)return Object(s.jsx)(P.m,{title:n,buttonData:{link:"/app/proposal/".concat(t.id,"/edit"),text:"Edit Proposal"}});if("simple"==t.type)return Object(s.jsx)(P.m,{title:n,buttonData:{link:"/app/simple-proposal/".concat(t.id,"/edit"),text:"Edit Simple Proposal"}})}return Object(s.jsx)(P.m,{title:n})}},{key:"renderDetail",value:function(){var e=this.state.proposal;return Object(s.jsx)(m.a,{isAutoExpand:"approved"===e.status&&!(e.votes&&e.votes.length),proposal:e,refreshLogs:this.handleRefreshLogs,allowEdit:!0})}},{key:"renderChangeContent",value:function(){var e=this.state,t=e.showForm,n=e.proposal;return t?Object(s.jsx)(N,{proposal:n,onClose:this.cancelForm}):this.state.isShowLogs&&Object(s.jsx)(S.a,{isAutoExpand:"approved"===n.status&&!(n.votes&&n.votes.length),proposal:n,onShow:this.showForm})}},{key:"render",value:function(){var e=this,t=this.props.authUser,n=this.state,r=n.loading,i=n.proposal;if(!t||!t.id||r)return null;if(!i||!i.id)return Object(s.jsx)("div",{children:"We can't find any details"});if(t.is_admin);else if(t.is_member){if(t.id==i.user_id);else if("approved"!=i.status&&"completed"!=i.status)return Object(s.jsx)(b.a,{to:"/app"})}else if(t.id==i.user_id);else if("approved"!=i.status&&"completed"!=i.status)return Object(s.jsx)(b.a,{to:"/app"});return Object(s.jsxs)("div",{id:"app-single-proposal-page",children:[this.renderHeader(),Object(s.jsx)(C.a,{proposal:i,onRefresh:function(){return e.getProposal()}}),this.renderDetail(),this.renderChangeContent()]})}}]),n}(p.Component);t.default=Object(d.b)((function(e){return{authUser:e.global.authUser,settings:e.global.settings,startInformalAdmin:e.admin.startInformalAdmin}}))(Object(b.g)(B))}}]);
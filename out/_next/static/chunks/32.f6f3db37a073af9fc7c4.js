(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[32],{CfA3:function(e,t,s){"use strict";s.r(t);var n=s("nKUr"),c=s("1OyB"),i=s("vuIU"),a=s("Ji7U"),r=s("md7G"),l=s("foSv"),o=s("q1tI"),d=s("/MKj"),u=s("Ty5D"),p=s("s/m+"),h=(s("4rsB"),s("o0o1")),b=s.n(h),j=s("HaE+"),f=s("KQm4"),m=s("JX7q"),g=s("rePB"),O=s("e+cM"),v=s("LADp"),x=s("ZpDd");s("Q9sc");function y(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,n=Object(l.a)(e);if(t){var c=Object(l.a)(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Object(r.a)(this,s)}}var N=s("wd/R"),_=function(e){Object(a.a)(s,e);var t=k(s);function s(e){var n;return Object(c.a)(this,s),n=t.call(this,e),Object(g.a)(Object(m.a)(n),"trackScroll",(function(){n.$elem&&n.$elem.scrollTop+n.$elem.clientHeight>=n.$elem.scrollHeight&&n.runNextPage()})),Object(g.a)(Object(m.a)(n),"handleSearch",(function(e){n.setState({search:e.target.value},(function(){n.timer&&(clearTimeout(n.timer),n.timer=null),n.timer=setTimeout((function(){n.reloadTable()}),500)}))})),n.state={loading:!1,proposals:[],sort_key:"final_grant.id",sort_direction:"desc",search:"",page_id:1,calling:!1,finished:!1},n.$elem=null,n.timer=null,n}return Object(i.a)(s,[{key:"componentDidMount",value:function(){var e=this,t=this.props.authUser;t&&t.id&&this.startTracking(),this.getProposals(),this.props.dispatch(Object(v.u)((function(){}),(function(s){s.success&&(t.check_active_grant=0,e.props.dispatch(Object(x.S)(function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?y(Object(s),!0).forEach((function(t){Object(g.a)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):y(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},t))))})))}},{key:"componentWillUnmount",value:function(){this.$elem&&this.$elem.removeEventListener("scroll",this.trackScroll)}},{key:"componentDidUpdate",value:function(e){var t=this.props,s=t.authUser,n=t.grantTableStatus;e.authUser&&e.authUser.id||!s||!s.id||this.startTracking(),!e.grantTableStatus&&n&&(this.reloadTable(),this.props.dispatch(Object(x.gb)(!1)))}},{key:"startTracking",value:function(){this.$elem=document.getElementById("app-grants-sectionBody"),this.$elem&&this.$elem.addEventListener("scroll",this.trackScroll)}},{key:"reloadTable",value:function(){var e=this;this.setState({page_id:1,proposals:[],finished:!1},(function(){e.getProposals()}))}},{key:"runNextPage",value:function(){var e=this,t=this.state,s=t.calling,n=t.loading,c=t.finished,i=t.page_id;s||n||c||this.setState({page_id:i+1},(function(){e.getProposals(!1)}))}},{key:"getProposals",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],s=this.state,n=s.calling,c=s.loading,i=s.finished,a=s.sort_key,r=s.sort_direction,l=s.search,o=s.page_id,d=s.proposals;if(!(c||n||i)){var u={sort_key:a,sort_direction:r,search:l,page_id:o,limit:20};this.props.dispatch(Object(v.lb)(u,(function(){t?e.setState({loading:!0,calling:!0}):e.setState({loading:!1,calling:!0})}),(function(t){var s=t.proposals||[],n=t.finished||!1;e.setState({loading:!1,calling:!1,finished:n,proposals:[].concat(Object(f.a)(d),Object(f.a)(s))})})))}}},{key:"clickActivate",value:function(e){this.props.dispatch(Object(x.ab)({"activate-grant":{render:!0,title:"Please upload the grant document with the association President's signature approving and activating this grant.",data:e}})),this.props.dispatch(Object(x.T)("custom-global-modal"))}},{key:"clickReSubmit",value:function(){var e=Object(j.a)(b.a.mark((function e(t,s){var n,c,i,a,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.proposal.milestones,c=s.milestone_id,i={},a=0;case 4:if(!(a<n.length)){e.next=11;break}if(n[a].id!=c){e.next=8;break}return i=n[a],e.abrupt("break",11);case 8:a++,e.next=4;break;case 11:if(i&&i.id){e.next=13;break}return e.abrupt("return");case 13:return r={index:t.milestones_submitted-1,proposal:t.proposal,milestone:i},e.next=16,this.props.dispatch(Object(x.kb)(r));case 16:return e.next=18,this.props.dispatch(Object(x.T)("milestone-vote"));case 18:case"end":return e.stop()}}),e,this)})));return function(t,s){return e.apply(this,arguments)}}()},{key:"clickSubmit",value:function(){var e=Object(j.a)(b.a.mark((function e(t){var s,n,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.proposal.milestones,n=t.milestones_submitted,s[n]){e.next=4;break}return e.abrupt("return");case 4:return c={index:n,proposal:t.proposal,milestone:s[n]},e.next=7,this.props.dispatch(Object(x.kb)(c));case 7:return e.next=9,this.props.dispatch(Object(x.T)("milestone-vote"));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startFormalMilestoneVote",value:function(e){var t,s=this,n=null===(t=e.proposal)||void 0===t?void 0:t.votes[e.proposal.votes.length-1];this.props.dispatch(Object(v.kc)(e.proposal_id,n.id,(function(){s.props.dispatch(Object(x.wb)())}),(function(e){s.props.dispatch(Object(x.P)()),e.success&&s.props.dispatch(Object(x.vb)("Formal voting process has been started successfully","success"))})))}},{key:"renderAction",value:function(e){var t=this;if("active"==e.status){if(0==e.milestones_submitted)return e.in_review?Object(n.jsx)("button",{className:"btn btn-primary extra-small btn-fluid-small",onClick:function(e){return e.stopPropagation()},children:"In review with Admin"}):Object(n.jsx)("a",{className:"btn btn-primary extra-small btn-fluid-small",onClick:function(){return t.clickSubmit(e)},children:"Submit Next Milestone"});var s=e.proposal.votes,c=s[s.length-1];if("milestone"==c.content_type)if("success"==c.result){if("formal"==c.type)return e.in_review?Object(n.jsx)("button",{className:"btn btn-primary extra-small btn-fluid-small",onClick:function(e){return e.stopPropagation()},children:"In review with Admin"}):Object(n.jsx)("a",{className:"btn btn-primary extra-small btn-fluid-small",onClick:function(){return t.clickSubmit(e)},children:"Submit Next Milestone"});if("informal"==c.type)return Object(n.jsx)("a",{className:"btn btn-primary extra-small btn-fluid-small",onClick:function(){return t.startFormalMilestoneVote(e)},children:"Start Formal Milestone Vote"})}else if("fail"==c.result)return Object(n.jsx)("a",{className:"btn btn-primary extra-small btn-fluid-small",onClick:function(){return t.clickReSubmit(e,c)},children:"Re-Submit Milestone"})}return Object(n.jsx)("label",{children:"-"})}},{key:"showSignDialog",value:function(e){if(!e.proposal||!e.signture_grants||!e.signture_grants.length)return null;this.props.dispatch(Object(x.ab)({signatures:{render:!0,title:"Grant Agreement Signatures",data:e.signture_grants}})),this.props.dispatch(Object(x.T)("custom-global-modal"))}},{key:"renderStatus",value:function(e){return"pending"==e.status?Object(n.jsx)("p",{className:"font-size-14 color-primary",children:"Pending"}):"active"==e.status?Object(n.jsx)("p",{className:"font-size-14 color-info",children:"Active"}):Object(n.jsx)("p",{className:"font-size-14 color-success",children:"Completed"})}},{key:"renderMilestonesComplete",value:function(e){return e.milestones_complete?Object(n.jsx)("p",{className:"font-size-14",children:e.milestones_complete}):Object(n.jsx)("p",{className:"font-size-14",children:"0"})}},{key:"clickRow",value:function(e){var t=this.props,s=t.history,n=t.authUser;n.is_admin||n.is_member?s.push("/app/proposal/".concat(e.proposal_id)):n.is_participant&&(e.user_id==n.id?s.push("/app/proposal/".concat(e.proposal_id)):e.votes&&e.votes.length||s.push("/app/proposal/".concat(e.proposal_id)))}},{key:"renderProposals",value:function(){var e=this,t=this.state.proposals,s=[];return t&&t.length?(t.forEach((function(t){s.push(Object(n.jsx)("li",{children:Object(n.jsxs)("div",{className:"infinite-row",onClick:function(){return e.clickRow(t)},children:[Object(n.jsx)("div",{className:"c-col-1 c-cols",children:Object(n.jsx)("label",{className:"font-size-14 font-weight-700",children:t.proposal_id})}),Object(n.jsx)("div",{className:"c-col-2 c-cols",children:Object(n.jsx)("label",{className:"font-size-14 font-weight-700",children:e.renderTitle(t)})}),Object(n.jsx)("div",{className:"c-col-3 c-cols",children:e.renderStatus(t)}),Object(n.jsx)("div",{className:"c-col-4 c-cols",children:Object(n.jsxs)("label",{className:"font-size-14",children:[N(t.created_at).local().format("M/D/YYYY")," ",N(t.created_at).local().format("h:mm A")]})}),Object(n.jsx)("div",{className:"c-col-5 c-cols",children:e.renderMilestonesComplete(t)}),Object(n.jsx)("div",{className:"c-col-6 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:t.milestones_total||0})}),Object(n.jsx)("div",{className:"c-col-7 c-cols",children:e.renderAction(t)})]})},"proposal_".concat(t.id)))})),Object(n.jsx)("ul",{children:s})):Object(n.jsx)("div",{id:"infinite-no-result",children:Object(n.jsx)("label",{className:"font-size-14",children:"No Results Found"})})}},{key:"renderTitle",value:function(e){return e.proposal.title}},{key:"renderTriangle",value:function(e){var t=this.state,s=t.sort_key,c=t.sort_direction;return s!=e?Object(n.jsx)("span",{className:"inactive",children:"\u25b2"}):"asc"==c?Object(n.jsx)("span",{children:"\u25b2"}):Object(n.jsx)("span",{children:"\u25bc"})}},{key:"clickHeader",value:function(e){var t=this,s=this.state,n=s.sort_key,c=s.sort_direction;n==e?c="asc"==c?"desc":"asc":(n=e,c="desc"),this.setState({sort_key:n,sort_direction:c},(function(){t.reloadTable()}))}},{key:"renderHeader",value:function(){var e=this;return Object(n.jsx)("div",{className:"infinite-header",children:Object(n.jsxs)("div",{className:"infinite-headerInner",children:[Object(n.jsx)("div",{className:"c-col-1 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Proposal #"})}),Object(n.jsx)("div",{className:"c-col-2 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Title"})}),Object(n.jsxs)("div",{className:"c-col-3 c-cols",onClick:function(){return e.clickHeader("final_grant.status")},children:[Object(n.jsx)("label",{className:"font-size-14",children:"Status"}),this.renderTriangle("final_grant.status")]}),Object(n.jsxs)("div",{className:"c-col-4 c-cols",onClick:function(){return e.clickHeader("final_grant.created_at")},children:[Object(n.jsx)("label",{className:"font-size-14",children:"Start Date"}),this.renderTriangle("final_grant.created_at")]}),Object(n.jsx)("div",{className:"c-col-5 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Milestones Complete"})}),Object(n.jsx)("div",{className:"c-col-6 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Milestones Total"})}),Object(n.jsx)("div",{className:"c-col-7 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Action"})})]})})}},{key:"render",value:function(){var e=this.state,t=e.loading,s=e.search,c=this.props.authUser;return c&&c.id?Object(n.jsxs)("section",{id:"app-grants-section",className:"app-infinite-box member-grant",children:[Object(n.jsxs)("div",{className:"app-infinite-search-wrap",children:[Object(n.jsx)("label",{children:"Grants"}),Object(n.jsx)("input",{type:"text",value:s,onChange:this.handleSearch,placeholder:"Search..."})]}),Object(n.jsx)("div",{className:"infinite-content",children:Object(n.jsxs)("div",{className:"infinite-contentInner",children:[this.renderHeader(),Object(n.jsx)("div",{className:"infinite-body",id:"app-grants-sectionBody",children:t?Object(n.jsx)(O.f,{}):this.renderProposals()})]})})]}):null}}]),s}(o.Component),S=Object(d.b)((function(e){return{authUser:e.global.authUser,grantTableStatus:e.table.grantTableStatus}}))(Object(u.g)(_)),T=(s("hV88"),s("55Ip"));function P(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function w(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?P(Object(s),!0).forEach((function(t){Object(g.a)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):P(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,n=Object(l.a)(e);if(t){var c=Object(l.a)(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Object(r.a)(this,s)}}var R="pending",C=function(e){Object(a.a)(s,e);var t=z(s);function s(e){var n;return Object(c.a)(this,s),n=t.call(this,e),Object(g.a)(Object(m.a)(n),"trackScroll",(function(){n.$elem&&n.$elem.scrollTop+n.$elem.clientHeight>=n.$elem.scrollHeight&&n.runNextPage()})),Object(g.a)(Object(m.a)(n),"handleSearch",(function(e){n.setState({search:e.target.value},(function(){n.timer&&(clearTimeout(n.timer),n.timer=null),n.timer=setTimeout((function(){n.reloadTable()}),500)}))})),n.state={loading:!1,proposals:[],sort_key:"final_grant.id",sort_direction:"desc",search:"",page_id:1,calling:!1,finished:!1},n.$elem=null,n.timer=null,n}return Object(i.a)(s,[{key:"componentDidMount",value:function(){var e=this.props.authUser;e&&e.id&&this.startTracking(),this.getProposals()}},{key:"componentWillUnmount",value:function(){this.$elem&&this.$elem.removeEventListener("scroll",this.trackScroll)}},{key:"componentDidUpdate",value:function(e){var t=this.props,s=t.authUser,n=t.grantTableStatus;e.authUser&&e.authUser.id||!s||!s.id||this.startTracking(),!e.grantTableStatus&&n&&(this.reloadTable(),this.props.dispatch(Object(x.gb)(!1)))}},{key:"startTracking",value:function(){this.$elem=document.getElementById("app-grants-sectionBody"),this.$elem&&this.$elem.addEventListener("scroll",this.trackScroll)}},{key:"reloadTable",value:function(){var e=this;this.setState({page_id:1,proposals:[],finished:!1},(function(){e.getProposals()}))}},{key:"runNextPage",value:function(){var e=this,t=this.state,s=t.calling,n=t.loading,c=t.finished,i=t.page_id;s||n||c||this.setState({page_id:i+1},(function(){e.getProposals(!1)}))}},{key:"getProposals",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],s=this.state,n=s.calling,c=s.loading,i=s.finished,a=s.sort_key,r=s.sort_direction,l=s.search,o=s.page_id,d=s.proposals;if(!(c||n||i)){var u={sort_key:a,sort_direction:r,search:l,page_id:o,limit:20,status:R};this.props.dispatch(Object(v.lb)(u,(function(){t?e.setState({loading:!0,calling:!0}):e.setState({loading:!1,calling:!0})}),(function(t){var s=t.proposals||[],n=t.finished||!1;e.setState({loading:!1,calling:!1,finished:n,proposals:[].concat(Object(f.a)(d),Object(f.a)(s))})})))}}},{key:"clickActivate",value:function(e){this.props.dispatch(Object(x.ab)({"activate-grant":{render:!0,title:"Please upload the grant document with the association President's signature approving and activating this grant.",data:e}})),this.props.dispatch(Object(x.T)("custom-global-modal"))}},{key:"showSignDialog",value:function(e){if(!e.proposal||!e.signture_grants||!e.signture_grants.length)return null;this.props.dispatch(Object(x.ab)({signatures:{render:!0,title:"Grant Agreement Signatures",data:e.signture_grants}})),this.props.dispatch(Object(x.T)("custom-global-modal"))}},{key:"clickBeginGrant",value:function(e){var t=this;5===+e.signture_grants.filter((function(e){return e.signed})).length&&this.props.dispatch(Object(v.m)(e.id,(function(){t.props.dispatch(Object(x.wb)())}),(function(e){t.props.dispatch(Object(x.P)()),e&&e.success&&t.reloadTable()})))}},{key:"renderGrantAction",value:function(e){var t=this,s=+e.signture_grants.filter((function(e){return e.signed})).length;return Object(n.jsxs)("div",{className:"d-flex align-items-center flex-column",children:[Object(n.jsx)("button",{className:"w-100 btn extra-small btn-primary btn-fluid-small",onClick:function(){return t.clickBeginGrant(e)},disabled:s<5,children:"Activate"}),"pending"==e.status&&Object(n.jsx)("a",{className:"mt-2 font-size-12 text-underline",onClick:function(){return t.clickActivate(e)},style:{color:"inherit"},children:"Force Activation"})]})}},{key:"renderStatus",value:function(e){return"pending"==e.status?Object(n.jsx)("p",{className:"font-size-14 color-primary",children:"Pending"}):"active"==e.status?Object(n.jsx)("p",{className:"font-size-14 color-info",children:"Active"}):Object(n.jsx)("p",{className:"font-size-14 color-success",children:"Completed"})}},{key:"clickRow",value:function(e){var t=this.props,s=t.history,n=t.authUser;n.is_admin||n.is_member?s.push("/app/proposal/".concat(e.proposal_id)):n.is_participant&&(e.user_id==n.id?s.push("/app/proposal/".concat(e.proposal_id)):e.votes&&e.votes.length||s.push("/app/proposal/".concat(e.proposal_id)))}},{key:"remind",value:function(e){var t=this;this.props.dispatch(Object(v.Tb)(e.id,(function(){t.props.dispatch(Object(x.wb)())}),(function(e){e.success&&t.props.dispatch(Object(x.vb)("Remind successfully","success")),t.props.dispatch(Object(x.P)())})))}},{key:"resend",value:function(e){var t=this;this.props.dispatch(Object(v.Vb)(e.id,(function(){t.props.dispatch(Object(x.wb)())}),(function(s){if(s.success){var n=t.state.proposals,c=n.findIndex((function(t){return t.id===e.id}));n[c].signture_grants=e.signture_grants.map((function(e){return 0===e.signed})),t.setState(w(w({},t.state),{},{proposals:Object(f.a)(n)})),t.props.dispatch(Object(x.vb)("Resend successfully","success"))}t.props.dispatch(Object(x.P)())})))}},{key:"renderSignAgreement",value:function(e){var t=this,s=+e.signture_grants.filter((function(e){return e.signed})).length;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("a",{onClick:function(){return t.showSignDialog(e)},children:[s,"/",5]}),Object(n.jsx)("a",{className:"mt-2 d-block font-size-14 text-underline",onClick:function(){return t.remind(e)},style:{color:"inherit"},children:"Remind"}),Object(n.jsx)("a",{className:"mt-2 d-block font-size-14 text-underline",onClick:function(){return t.resend(e)},style:{color:"inherit"},children:"Resend"})]})}},{key:"renderTitle",value:function(e){return e.proposal.title}},{key:"renderTriangle",value:function(e){var t=this.state,s=t.sort_key,c=t.sort_direction;return s!=e?Object(n.jsx)("span",{className:"inactive",children:"\u25b2"}):"asc"==c?Object(n.jsx)("span",{children:"\u25b2"}):Object(n.jsx)("span",{children:"\u25bc"})}},{key:"clickHeader",value:function(e){var t=this,s=this.state,n=s.sort_key,c=s.sort_direction;n==e?c="asc"==c?"desc":"asc":(n=e,c="desc"),this.setState({sort_key:n,sort_direction:c},(function(){t.reloadTable()}))}},{key:"renderPendingHeader",value:function(){var e=this;return Object(n.jsx)("div",{className:"infinite-header",children:Object(n.jsxs)("div",{className:"infinite-headerInner",children:[Object(n.jsx)("div",{className:"c-col-1 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"#"})}),Object(n.jsx)("div",{className:"c-col-2 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Title"})}),Object(n.jsx)("div",{className:"c-col-3 c-cols",children:Object(n.jsx)("p",{className:"font-size-14 font-weight-700",children:"OP Email"})}),Object(n.jsxs)("div",{className:"c-col-4 c-cols",onClick:function(){return e.clickHeader("final_grant.status")},children:[Object(n.jsx)("label",{className:"font-size-14",children:"Status"}),this.renderTriangle("final_grant.status")]}),Object(n.jsx)("div",{className:"c-col-5 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Signatures"})}),Object(n.jsx)("div",{className:"c-col-6 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Action"})})]})})}},{key:"renderPendingProposals",value:function(){var e=this,t=this.state.proposals,s=[];return t&&t.length?(t.forEach((function(t){s.push(Object(n.jsx)("li",{children:Object(n.jsxs)("div",{className:"infinite-row",children:[Object(n.jsx)("div",{className:"c-col-1 c-cols",children:Object(n.jsx)("p",{className:"font-size-14 font-weight-700",children:t.proposal_id})}),Object(n.jsx)("div",{className:"c-col-2 c-cols",onClick:function(){return e.clickRow(t)},children:Object(n.jsx)("p",{className:"font-size-14 font-weight-700 text-elipse",children:e.renderTitle(t)})}),Object(n.jsx)("div",{className:"c-col-3 c-cols",children:Object(n.jsx)("p",{className:"font-size-14 font-weight-700",children:Object(n.jsx)(T.b,{className:"text-elipse",to:"/app/user/".concat(t.proposal.user_id),style:{color:"inherit"},children:t.proposal.user.email})})}),Object(n.jsx)("div",{className:"c-col-4 c-cols",children:e.renderStatus(t)}),Object(n.jsx)("div",{className:"c-col-5 c-cols",children:e.renderSignAgreement(t)}),Object(n.jsx)("div",{className:"c-col-6 c-cols",children:e.renderGrantAction(t)})]})},"proposal_".concat(t.id)))})),Object(n.jsx)("ul",{children:s})):Object(n.jsx)("div",{id:"infinite-no-result",children:Object(n.jsx)("label",{className:"font-size-14",children:"No Results Found"})})}},{key:"render",value:function(){var e=this.state,t=e.loading,s=e.search,c=this.props.authUser;return c&&c.id?Object(n.jsxs)("section",{id:"app-grants-section",className:"app-infinite-box admin admin-pending-grant",children:[Object(n.jsxs)("div",{className:"app-infinite-search-wrap",children:[Object(n.jsx)("label",{children:"Grants Pending Activation"}),Object(n.jsx)("input",{type:"text",value:s,onChange:this.handleSearch,placeholder:"Search..."})]}),Object(n.jsx)("div",{className:"infinite-content",children:Object(n.jsxs)("div",{className:"infinite-contentInner",children:[this.renderPendingHeader(),Object(n.jsx)("div",{className:"infinite-body",id:"app-grants-sectionBody",children:t?Object(n.jsx)(O.f,{}):this.renderPendingProposals()})]})})]}):null}}]),s}(o.Component),U=Object(d.b)((function(e){return{authUser:e.global.authUser,grantTableStatus:e.table.grantTableStatus}}))(Object(u.g)(C));s("BliC");function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,n=Object(l.a)(e);if(t){var c=Object(l.a)(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Object(r.a)(this,s)}}var A=s("wd/R"),$="active",E=function(e){Object(a.a)(s,e);var t=D(s);function s(e){var n;return Object(c.a)(this,s),n=t.call(this,e),Object(g.a)(Object(m.a)(n),"trackScroll",(function(){n.$elem&&n.$elem.scrollTop+n.$elem.clientHeight>=n.$elem.scrollHeight&&n.runNextPage()})),Object(g.a)(Object(m.a)(n),"handleSearch",(function(e){n.setState({search:e.target.value},(function(){n.timer&&(clearTimeout(n.timer),n.timer=null),n.timer=setTimeout((function(){n.reloadTable()}),500)}))})),n.state={loading:!1,proposals:[],sort_key:"final_grant.id",sort_direction:"desc",search:"",page_id:1,calling:!1,finished:!1},n.$elem=null,n.timer=null,n}return Object(i.a)(s,[{key:"componentDidMount",value:function(){var e=this.props.authUser;e&&e.id&&this.startTracking(),this.getProposals()}},{key:"componentWillUnmount",value:function(){this.$elem&&this.$elem.removeEventListener("scroll",this.trackScroll)}},{key:"componentDidUpdate",value:function(e){var t=this.props,s=t.authUser,n=t.grantTableStatus;e.authUser&&e.authUser.id||!s||!s.id||this.startTracking(),!e.grantTableStatus&&n&&(this.reloadTable(),this.props.dispatch(Object(x.gb)(!1)))}},{key:"startTracking",value:function(){this.$elem=document.getElementById("app-active-grants-sectionBody"),this.$elem&&this.$elem.addEventListener("scroll",this.trackScroll)}},{key:"reloadTable",value:function(){var e=this;this.setState({page_id:1,proposals:[],finished:!1},(function(){e.getProposals()}))}},{key:"runNextPage",value:function(){var e=this,t=this.state,s=t.calling,n=t.loading,c=t.finished,i=t.page_id;s||n||c||this.setState({page_id:i+1},(function(){e.getProposals(!1)}))}},{key:"getProposals",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],s=this.state,n=s.calling,c=s.loading,i=s.finished,a=s.sort_key,r=s.sort_direction,l=s.search,o=s.page_id,d=s.proposals;if(!(c||n||i)){var u={sort_key:a,sort_direction:r,search:l,page_id:o,limit:20,status:$};this.props.dispatch(Object(v.lb)(u,(function(){t?e.setState({loading:!0,calling:!0}):e.setState({loading:!1,calling:!0})}),(function(t){var s=t.proposals||[],n=t.finished||!1;e.setState({loading:!1,calling:!1,finished:n,proposals:[].concat(Object(f.a)(d),Object(f.a)(s))})})))}}},{key:"showSignDialog",value:function(e){if(!e.proposal||!e.signture_grants||!e.signture_grants.length)return null;this.props.dispatch(Object(x.ab)({signatures:{render:!0,title:"Grant Agreement Signatures",data:e.signture_grants}})),this.props.dispatch(Object(x.T)("custom-global-modal"))}},{key:"openSignedGrant",value:function(e){var t=this;this.props.dispatch(Object(v.Pc)(e.id,(function(){t.props.dispatch(Object(x.wb)())}),(function(e){e.success&&window.open(e.file_url,"_blank").focus(),t.props.dispatch(Object(x.P)())})))}},{key:"renderSignAgreement",value:function(e){var t=this;return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)("button",{className:"w-100 btn extra-small btn-primary btn-fluid-small",onClick:function(){return t.openSignedGrant(e)},children:"View"})})}},{key:"renderStatus",value:function(e){return"pending"==e.status?Object(n.jsx)("p",{className:"font-size-14 color-primary",children:"Pending"}):"active"==e.status?Object(n.jsx)("p",{className:"font-size-14 color-info",children:"Active"}):Object(n.jsx)("p",{className:"font-size-14 color-success",children:"Completed"})}},{key:"renderMilestonesComplete",value:function(e){return Object(n.jsxs)("p",{className:"font-size-14 ".concat(+e.milestones_complete===+e.milestones_total?"text-success":""),children:[e.milestones_complete,"/",e.milestones_total]})}},{key:"clickRow",value:function(e){var t=this.props,s=t.history,n=t.authUser;n.is_admin||n.is_member?s.push("/app/proposal/".concat(e.proposal_id)):n.is_participant&&(e.user_id==n.id?s.push("/app/proposal/".concat(e.proposal_id)):e.votes&&e.votes.length||s.push("/app/proposal/".concat(e.proposal_id)))}},{key:"renderTitle",value:function(e){return e.proposal.title}},{key:"renderTriangle",value:function(e){var t=this.state,s=t.sort_key,c=t.sort_direction;return s!=e?Object(n.jsx)("span",{className:"inactive",children:"\u25b2"}):"asc"==c?Object(n.jsx)("span",{children:"\u25b2"}):Object(n.jsx)("span",{children:"\u25bc"})}},{key:"clickHeader",value:function(e){var t=this,s=this.state,n=s.sort_key,c=s.sort_direction;n==e?c="asc"==c?"desc":"asc":(n=e,c="desc"),this.setState({sort_key:n,sort_direction:c},(function(){t.reloadTable()}))}},{key:"renderActiveHeader",value:function(){var e=this;return Object(n.jsx)("div",{className:"infinite-header",children:Object(n.jsxs)("div",{className:"infinite-headerInner",children:[Object(n.jsx)("div",{className:"c-col-1 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"#"})}),Object(n.jsx)("div",{className:"c-col-2 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Title"})}),Object(n.jsx)("div",{className:"c-col-3 c-cols",children:Object(n.jsx)("p",{className:"font-size-14 font-weight-700",children:"OP Email"})}),Object(n.jsxs)("div",{className:"c-col-4 c-cols",onClick:function(){return e.clickHeader("final_grant.status")},children:[Object(n.jsx)("label",{className:"font-size-14",children:"Status"}),this.renderTriangle("final_grant.status")]}),Object(n.jsxs)("div",{className:"c-col-5 c-cols",onClick:function(){return e.clickHeader("final_grant.created_at")},children:[Object(n.jsx)("label",{className:"font-size-14",children:"Start Date"}),this.renderTriangle("final_grant.created_at")]}),Object(n.jsx)("div",{className:"c-col-6 c-cols",children:Object(n.jsxs)("label",{className:"font-size-14",children:["Milestones",Object(n.jsx)("br",{}),"Complete"]})}),Object(n.jsx)("div",{className:"c-col-7 c-cols",children:Object(n.jsx)("label",{className:"font-size-14",children:"Grant Agreement"})})]})})}},{key:"renderActiveProposals",value:function(){var e=this,t=this.state.proposals,s=[];return t&&t.length?(t.forEach((function(t){s.push(Object(n.jsx)("li",{children:Object(n.jsxs)("div",{className:"infinite-row",children:[Object(n.jsx)("div",{className:"c-col-1 c-cols",children:Object(n.jsx)("p",{className:"font-size-14 font-weight-700",children:t.proposal_id})}),Object(n.jsx)("div",{className:"c-col-2 c-cols",onClick:function(){return e.clickRow(t)},children:Object(n.jsx)("p",{className:"font-size-14 font-weight-700 text-elipse",children:e.renderTitle(t)})}),Object(n.jsx)("div",{className:"c-col-3 c-cols",children:Object(n.jsx)("p",{className:"font-size-14 font-weight-700",children:Object(n.jsx)(T.b,{className:"text-elipse",to:"/app/user/".concat(t.proposal.user_id),style:{color:"inherit"},children:t.proposal.user.email})})}),Object(n.jsx)("div",{className:"c-col-4 c-cols",children:e.renderStatus(t)}),Object(n.jsx)("div",{className:"c-col-5 c-cols",children:Object(n.jsxs)("p",{className:"font-size-14",children:[A(t.created_at).local().format("M/D/YYYY"),Object(n.jsx)("br",{}),A(t.created_at).local().format("h:mm A")]})}),Object(n.jsx)("div",{className:"c-col-6 c-cols",children:e.renderMilestonesComplete(t)}),Object(n.jsx)("div",{className:"c-col-7 c-cols",children:e.renderSignAgreement(t)})]})},"proposal_".concat(t.id)))})),Object(n.jsx)("ul",{children:s})):Object(n.jsx)("div",{id:"infinite-no-result",children:Object(n.jsx)("label",{className:"font-size-14",children:"No Results Found"})})}},{key:"render",value:function(){var e=this.state,t=e.loading,s=e.search,c=this.props.authUser;return c&&c.id?Object(n.jsxs)("section",{id:"app-grants-section",className:"app-infinite-box admin admin-active-grant",children:[Object(n.jsxs)("div",{className:"app-infinite-search-wrap",children:[Object(n.jsx)("label",{children:"Active Grants"}),Object(n.jsx)("input",{type:"text",value:s,onChange:this.handleSearch,placeholder:"Search..."})]}),Object(n.jsx)("div",{className:"infinite-content",children:Object(n.jsxs)("div",{className:"infinite-contentInner",children:[this.renderActiveHeader(),Object(n.jsx)("div",{className:"infinite-body",id:"app-active-grants-sectionBody",children:t?Object(n.jsx)(O.f,{}):this.renderActiveProposals()})]})})]}):null}}]),s}(o.Component),H=Object(d.b)((function(e){return{authUser:e.global.authUser,grantTableStatus:e.table.grantTableStatus}}))(Object(u.g)(E));function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,n=Object(l.a)(e);if(t){var c=Object(l.a)(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Object(r.a)(this,s)}}var B=function(e){Object(a.a)(s,e);var t=M(s);function s(e){return Object(c.a)(this,s),t.call(this,e)}return Object(i.a)(s,[{key:"render",value:function(){var e=this.props.authUser;return e&&e.id?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("div",{className:"pb-3 h-50",children:Object(n.jsx)(U,{})}),Object(n.jsx)("div",{className:"pt-3 h-50",children:Object(n.jsx)(H,{})})]}):null}}]),s}(o.Component),I=Object(d.b)((function(e){return{authUser:e.global.authUser}}))(Object(u.g)(B));function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,n=Object(l.a)(e);if(t){var c=Object(l.a)(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Object(r.a)(this,s)}}var F=function(e){Object(a.a)(s,e);var t=G(s);function s(e){return Object(c.a)(this,s),t.call(this,e)}return Object(i.a)(s,[{key:"render",value:function(){var e=this.props.authUser;return e&&e.id?Object(n.jsx)("div",{id:"grant-page",className:"h-100",children:Object(n.jsx)(p.Fade,{distance:"20px",bottom:!0,duration:300,delay:600,children:Object(n.jsxs)(n.Fragment,{children:[!e.is_admin&&Object(n.jsx)(S,{}),!!e.is_admin&&Object(n.jsx)(I,{})]})})}):null}}]),s}(o.Component);t.default=Object(d.b)((function(e){return{authUser:e.global.authUser}}))(Object(u.g)(F))}}]);
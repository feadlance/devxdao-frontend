(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[52],{R48a:function(e,t,s){"use strict";s.r(t);var a=s("nKUr"),n=s("1OyB"),r=s("vuIU"),i=s("JX7q"),c=s("Ji7U"),o=s("md7G"),l=s("foSv"),p=s("rePB"),d=s("q1tI"),u=s("/MKj"),b=s("Ty5D"),m=s("/Gi5"),h=s("ZRVi"),f=s("e+cM"),j=s("ZpDd"),O=s("LADp"),w=s("YW6W");s("ASB/");function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,a=Object(l.a)(e);if(t){var n=Object(l.a)(this).constructor;s=Reflect.construct(a,arguments,n)}else s=a.apply(this,arguments);return Object(o.a)(this,s)}}var _=function(e){Object(c.a)(s,e);var t=v(s);function s(e){var a;return Object(n.a)(this,s),a=t.call(this,e),Object(p.a)(Object(i.a)(a),"submit",(function(e){e.preventDefault();var t=a.state,s=t.forum_name,n=t.current_password,r=t.new_password,i=t.confirm_new_password;if(s.trim()){if(n||r||i){if(!n)return void a.props.dispatch(Object(j.Bb)("Please input current password"));if(!r)return void a.props.dispatch(Object(j.Bb)("Please input new password"));if(!i)return void a.props.dispatch(Object(j.Bb)("Please confirm new password"));if(r!=i)return void a.props.dispatch(Object(j.Bb)("Password doesn't match"));if(!w.a.checkPassword(r))return void a.props.dispatch(Object(j.Bb)("Please use a password with at least 8 characters including at least one number, one letter and one symbol"))}a.props.dispatch(Object(j.Cb)()),a.updateProfile().then((function(){a.changePassword().then((function(e){e?a.props.dispatch(Object(O.Ab)((function(){}),(function(){a.props.dispatch(Object(j.U)()),a.setState({disabled:!0,current_password:"",new_password:"",confirm_new_password:""}),a.props.dispatch(Object(j.Bb)("User settings have been updated successfully","success"))}))):a.props.dispatch(Object(j.U)())}))}))}else a.props.dispatch(Object(j.Bb)("Please input forum name"))})),Object(p.a)(Object(i.a)(a),"startEmail",(function(e){e.preventDefault();var t=a.state.email;a.props.authUser.email!=t?w.a.validateEmail(t)?(a.props.dispatch(Object(O.fb)()),a.setState({emailStep:1})):a.props.dispatch(Object(j.Bb)("Please input valid email address")):a.props.dispatch(Object(j.Bb)("Please input different email address"))})),Object(p.a)(Object(i.a)(a),"verify2FA",(function(e){e.preventDefault();var t=a.state,s=t.code,n=t.email;a.props.dispatch(Object(O.t)(s,(function(){a.props.dispatch(Object(j.Cb)())}),(function(e){a.props.dispatch(Object(j.U)()),e&&e.success&&(a.props.dispatch(Object(O.fb)(n)),a.setState({emailStep:2}))})))})),Object(p.a)(Object(i.a)(a),"completeEmail",(function(e){e.preventDefault();var t=a.state,s=t.code_new,n=t.email;a.props.dispatch(Object(O.t)(s,(function(){a.props.dispatch(Object(j.Cb)())}),(function(e){e.success&&n?a.props.dispatch(Object(O.kd)({email:n},(function(){}),(function(e){a.props.dispatch(Object(j.U)()),e.success&&(a.clearEmailStep(),a.props.dispatch(Object(j.Bb)("You've changed your email successfully!","success")))}))):a.props.dispatch(Object(j.U)())})))})),Object(p.a)(Object(i.a)(a),"clearEmailStep",(function(e){e.preventDefault(),a.setState({email:"",emailStep:0,code:"",code_new:""})})),Object(p.a)(Object(i.a)(a),"toggleTwoFA",(function(){var e=a.state.twoFA_login;a.setState({twoFA_login:!e},(function(){e?a.props.dispatch(Object(O.M)()):a.props.dispatch(Object(O.X)())}))})),a.state={forum_name:"",current_password:"",new_password:"",confirm_new_password:"",disabled:!0,email:"",emailStep:0,code:"",code_new:"",twoFA_login:0},a}return Object(r.a)(s,[{key:"componentDidMount",value:function(){var e=this.props.authUser;e&&e.id&&this.initValues()}},{key:"componentDidUpdate",value:function(e){var t=this.props.authUser;e.authUser&&e.authUser.id||!t||!t.id||this.initValues()}},{key:"initValues",value:function(){var e=this.props.authUser,t="";e.profile&&e.profile.forum_name&&(t=e.profile.forum_name);var s=0;e.profile&&e.profile.twoFA_login&&(s=e.profile.twoFA_login),this.setState({forum_name:t,twoFA_login:s})}},{key:"inputField",value:function(e,t){var s=this;this.setState(Object(p.a)({},t,e.target.value),(function(){s.checkButton()}))}},{key:"checkButton",value:function(){var e=this.state,t=e.forum_name,s=e.current_password,a=e.new_password,n=e.confirm_new_password,r=this.props.authUser,i=!1;(t&&r&&r.profile&&t!=r.profile.forum_name||s||a||n)&&(i=!0),this.setState({disabled:!i})}},{key:"updateProfile",value:function(){var e=this,t=this.props.authUser,s=this.state.forum_name;return new Promise((function(a){s&&t&&t.profile&&s!=t.profile.forum_name?e.props.dispatch(Object(O.rd)({forum_name:s},(function(){}),(function(){a(!0)}))):a(!1)}))}},{key:"changePassword",value:function(){var e=this,t=this.state,s=t.current_password,a=t.new_password;return new Promise((function(t){if(s&&a){var n={current_password:s,new_password:a};e.props.dispatch(Object(O.q)(n,(function(){}),(function(e){t(e.success)})))}else t(!0)}))}},{key:"renderEmailSection",value:function(){var e=this,t=this.props.authUser,s=this.state,n=s.email,r=s.emailStep,i=s.code,c=s.code_new;return r?1==r?Object(a.jsxs)(d.Fragment,{children:[Object(a.jsxs)("div",{className:"c-form-row mt-5",children:[Object(a.jsx)("label",{className:"mb-4",children:"Change Email Address"}),Object(a.jsxs)("label",{className:"font-size-12",children:["Current Email: ",t.email]}),Object(a.jsx)("input",{type:"text",placeholder:"Enter code",value:i,onChange:function(t){return e.inputField(t,"code")}})]}),Object(a.jsxs)("div",{id:"emailStep-buttons",children:[Object(a.jsx)("a",{className:i?"btn btn-primary small btn-fluid mb-3":"btn btn-primary small btn-fluid mb-3 disabled",onClick:this.verify2FA,children:"Next"}),Object(a.jsx)("a",{className:"btn btn-danger small btn-fluid mb-3",onClick:this.clearEmailStep,children:"Cancel"})]})]}):2==r?Object(a.jsxs)(d.Fragment,{children:[Object(a.jsxs)("div",{className:"c-form-row mt-5",children:[Object(a.jsx)("label",{className:"mb-4",children:"Change Email Address"}),Object(a.jsxs)("label",{className:"font-size-12",children:["Current Email: ",t.email]}),Object(a.jsx)("input",{type:"text",placeholder:"Enter code sent to your new email",value:c,onChange:function(t){return e.inputField(t,"code_new")}})]}),Object(a.jsxs)("div",{id:"emailStep-buttons",children:[Object(a.jsx)("a",{className:c?"btn btn-primary small btn-fluid mb-3":"btn btn-primary small btn-fluid mb-3 disabled",onClick:this.completeEmail,children:"Complete"}),Object(a.jsx)("a",{className:"btn btn-danger small btn-fluid mb-3",onClick:this.clearEmailStep,children:"Cancel"})]})]}):null:Object(a.jsxs)(d.Fragment,{children:[Object(a.jsxs)("div",{className:"c-form-row mt-5",children:[Object(a.jsx)("label",{className:"mb-4",children:"Change Email Address"}),Object(a.jsxs)("label",{className:"font-size-12",children:["Current Email: ",t.email]}),Object(a.jsx)("input",{type:"text",placeholder:"Enter new email",value:n,onChange:function(t){return e.inputField(t,"email")}})]}),Object(a.jsx)("a",{className:n?"btn btn-primary small btn-fluid mb-3":"btn btn-primary small btn-fluid mb-3 disabled",onClick:this.startEmail,children:"Start Change Email Process"})]})}},{key:"render",value:function(){var e=this,t=this.props.authUser;if(!t||!t.id)return null;var s=this.state,n=s.forum_name,r=s.current_password,i=s.new_password,c=s.confirm_new_password,o=s.disabled,l=s.twoFA_login;return Object(a.jsxs)("div",{id:"app-settings-page",className:"app-simple-section",children:[Object(a.jsx)("label",{className:"mb-5",id:"app-settings-pageHeader",children:"User Settings"}),Object(a.jsxs)("div",{children:[Object(a.jsxs)("form",{method:"POST",action:"",onSubmit:this.submit,children:[Object(a.jsx)(f.l,{type:"text"}),Object(a.jsx)(f.l,{type:"password"}),Object(a.jsxs)("div",{className:"c-form-row",children:[Object(a.jsx)("label",{children:"My Pseudonym"}),Object(a.jsx)("input",{type:"text",placeholder:"Forum Name/Pseudonym",value:n,onChange:function(t){return e.inputField(t,"forum_name")}})]}),Object(a.jsxs)("div",{className:"c-form-row",children:[Object(a.jsx)("label",{children:"Change Password"}),Object(a.jsx)("input",{type:"password",placeholder:"Type Current Password",value:r,onChange:function(t){return e.inputField(t,"current_password")}}),Object(a.jsx)("input",{type:"password",placeholder:"New Password",value:i,onChange:function(t){return e.inputField(t,"new_password")}}),Object(a.jsx)("input",{type:"password",placeholder:"Confirm New Password",value:c,onChange:function(t){return e.inputField(t,"confirm_new_password")}})]}),Object(a.jsx)("button",{type:"submit",className:"btn btn-primary small",disabled:o,children:"Save"})]}),Object(a.jsxs)("div",{className:"c-form-check-row",onClick:this.toggleTwoFA,children:[l?Object(a.jsx)(m.a,{color:"#9B64E6"}):Object(a.jsx)(h.a,{color:"#9B64E6"}),Object(a.jsx)("label",{children:"Two-Factor Authentication"})]}),this.renderEmailSection()]})]})}}]),s}(d.Component);t.default=Object(u.b)((function(e){return{authUser:e.global.authUser}}))(Object(b.g)(_))}}]);
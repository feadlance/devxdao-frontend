(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[45],{DJih:function(e,t,n){"use strict";n.r(t);var i=n("nKUr"),s=n("KQm4"),c=n("1OyB"),a=n("vuIU"),r=n("JX7q"),l=n("Ji7U"),o=n("md7G"),d=n("foSv"),p=n("rePB"),u=n("q1tI"),h=n.n(u),b=n("/MKj"),j=n("Ty5D"),f=n("s/m+"),m=n("17x9"),v=n.n(m);function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var n,i,s=function(e,t){if(null==e)return{};var n,i,s={},c=Object.keys(e);for(i=0;i<c.length;i++)n=c[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(i=0;i<c.length;i++)n=c[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var y=Object(u.forwardRef)((function(e,t){var n=e.color,i=void 0===n?"currentColor":n,s=e.size,c=void 0===s?24:s,a=g(e,["color","size"]);return h.a.createElement("svg",O({ref:t,xmlns:"http://www.w3.org/2000/svg",width:c,height:c,viewBox:"0 0 24 24",fill:"none",stroke:i,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},a),h.a.createElement("path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}),h.a.createElement("line",{x1:"4",y1:"22",x2:"4",y2:"15"}))}));y.propTypes={color:v.a.string,size:v.a.oneOfType([v.a.string,v.a.number])},y.displayName="Flag";var k=y,x=n("e+cM"),N=n("ZpDd"),w=n("YW6W"),_=n("LADp");n("q5pp");function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Object(d.a)(e);if(t){var s=Object(d.a)(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return Object(o.a)(this,n)}}var P=n("wd/R"),S=function(e){Object(l.a)(n,e);var t=T(n);function n(e){var i;return Object(c.a)(this,n),i=t.call(this,e),Object(p.a)(Object(r.a)(i),"trackScroll",(function(){i.$elem&&i.$elem.scrollTop+i.$elem.clientHeight>=i.$elem.scrollHeight&&i.runNextPage()})),Object(p.a)(Object(r.a)(i),"handleSearch",(function(e){i.setState({search:e.target.value},(function(){i.timer&&(clearTimeout(i.timer),i.timer=null),i.timer=setTimeout((function(){i.reloadTable()}),500)}))})),i.state={loading:!1,proposals:[],sort_key:"proposal.id",sort_direction:"desc",search:"",page_id:1,calling:!1,finished:!1},i.$elem=null,i.timer=null,i}return Object(a.a)(n,[{key:"componentDidMount",value:function(){var e=this.state.proposals;this.getProposals(),e&&e.length&&this.startTracking()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.pendingProposalTableStatus,i=this.state.proposals;t.proposals&&t.proposals.length||!i||!i.length||this.startTracking(),!e.pendingProposalTableStatus&&n&&(this.reloadTable(),this.props.dispatch(Object(N.cb)(!1)))}},{key:"componentWillUnmount",value:function(){this.$elem&&this.$elem.removeEventListener("scroll",this.trackScroll)}},{key:"startTracking",value:function(){this.$elem=document.getElementById("app-pending-proposals-sectionBody"),this.$elem&&this.$elem.addEventListener("scroll",this.trackScroll)}},{key:"reloadTable",value:function(){var e=this;this.setState({page_id:1,proposals:[],finished:!1},(function(){e.getProposals()}))}},{key:"runNextPage",value:function(){var e=this,t=this.state,n=t.calling,i=t.loading,s=t.finished,c=t.page_id;n||i||s||this.setState({page_id:c+1},(function(){e.getProposals(!1)}))}},{key:"getProposals",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.state,i=n.calling,c=n.loading,a=n.finished,r=n.sort_key,l=n.sort_direction,o=n.search,d=n.page_id,p=n.proposals;if(!(c||i||a)){var u={sort_key:r,sort_direction:l,search:o,page_id:d,limit:20};this.props.dispatch(Object(_.Gb)(u,(function(){t?e.setState({loading:!0,calling:!0}):e.setState({loading:!1,calling:!0})}),(function(t){var n=t.proposals||[],i=t.finished||!1;e.setState({loading:!1,calling:!1,finished:i,proposals:[].concat(Object(s.a)(p),Object(s.a)(n))})})))}}},{key:"approve",value:function(e,t){var n=this;e.preventDefault(),confirm("Are you sure you are going to approve the selected proposal?")&&this.props.dispatch(Object(_.h)(t.id,(function(){n.props.dispatch(Object(N.Cb)())}),(function(){n.props.dispatch(Object(N.U)()),n.reloadTable(),n.props.dispatch(Object(N.ab)(!0))})))}},{key:"deny",value:function(e,t){e.preventDefault(),this.props.dispatch(Object(N.xb)(t)),this.props.dispatch(Object(N.Z)("deny-proposal"))}},{key:"clickRow",value:function(e){var t=this.props,n=t.authUser,i=t.history;n&&n.is_admin&&i.push("/app/proposal/".concat(e.id))}},{key:"clickWithdraw",value:function(e,t){e.preventDefault(),this.props.dispatch(Object(N.gb)({"confirm-withdraw":{render:!0,title:"Are you sure you want to withdraw this proposal?",data:t}})),this.props.dispatch(Object(N.Z)("custom-global-modal"))}},{key:"clickReviewPayment",value:function(e,t){e.preventDefault(),this.props.dispatch(Object(N.ib)(t)),this.props.dispatch(Object(N.Z)("dos-review"))}},{key:"clickDenied",value:function(e,t){e.preventDefault(),this.props.dispatch(Object(N.jb)(t)),this.props.dispatch(Object(N.Z)("edit-deny"))}},{key:"renderTitle",value:function(e){return e.title}},{key:"renderTooltip",value:function(){return Object(i.jsx)(u.Fragment,{children:Object(i.jsx)("p",{className:"font-size-13",children:"This area shows any proposals that are waiting for admin approval or need further action from you. If no action is needed, proposals will disappear from this section and be found below."})})}},{key:"renderFlag",value:function(e){var t=e.relationship||"";return(t=t.split(",")).includes("0")?Object(i.jsx)(k,{}):null}},{key:"renderActions",value:function(e){var t=this;return"pending"==e.status?Object(i.jsxs)("div",{className:"c-action-buttons",children:[Object(i.jsx)("a",{className:"btn btn-success extra-small",onClick:function(n){return t.approve(n,e)},children:"Approve"}),Object(i.jsx)("a",{className:"btn btn-danger extra-small",onClick:function(n){return t.deny(n,e)},children:"Deny"})]}):"payment"==e.status&&e.dos_paid?Object(i.jsx)("div",{className:"c-action-buttons",children:Object(i.jsx)("a",{className:"btn btn-info btn-fluid-small extra-small",onClick:function(n){return t.clickReviewPayment(n,e)},children:"Review Payment"})}):e.dos_paid?null:Object(i.jsxs)(u.Fragment,{children:[Object(i.jsx)("label",{className:"font-size-12 color-primary d-block",onClick:function(){return t.clickRow(e)},children:"Payment Waiting"}),Object(i.jsx)("a",{className:"btn btn-danger-outline extra-small btn-fluid-small",style:{paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"0.5rem"},onClick:function(n){return t.clickWithdraw(n,e)},children:"Force Withdraw"})]})}},{key:"renderProposals",value:function(){var e=this,t=this.state.proposals,n=[];return t&&t.length?(t.forEach((function(t,s){n.push(Object(i.jsx)("li",{children:Object(i.jsxs)("div",{className:"infinite-row",children:[Object(i.jsx)("div",{className:"c-col-0 c-cols",onClick:function(){return e.clickRow(t)},children:Object(i.jsx)("label",{className:"font-size-14 d-block",children:t.id})}),Object(i.jsxs)("div",{className:"c-col-1 c-cols",onClick:function(){return e.clickRow(t)},children:[Object(i.jsx)("label",{className:"font-size-14 font-weight-700",children:e.renderTitle(t)}),Object(i.jsx)("p",{className:"font-size-12",children:w.a.getExcerpt(t.short_description||t.member_reason)})]}),Object(i.jsx)("div",{className:"c-col-2 c-cols",onClick:function(){return e.clickRow(t)},children:e.renderFlag(t)}),Object(i.jsx)("div",{className:"c-col-3 c-cols",onClick:function(){return e.clickRow(t)},children:Object(i.jsx)("label",{className:"font-size-14",children:"grant"==t.type?"Grant":"Simple"})}),Object(i.jsx)("div",{className:"c-col-4 c-cols",onClick:function(){return e.clickRow(t)},children:Object(i.jsxs)("label",{className:"font-size-14",children:[P(t.created_at).local().format("M/D/YYYY")," ",P(t.created_at).local().format("h:mm A")]})}),Object(i.jsx)("div",{className:"c-col-5 c-cols",children:e.renderActions(t)})]})},"proposal_".concat(s)))})),Object(i.jsx)("ul",{children:n})):Object(i.jsx)("div",{id:"infinite-no-result",children:Object(i.jsx)("label",{className:"font-size-14",children:"No Results Found"})})}},{key:"renderTriangle",value:function(e){var t=this.state,n=t.sort_key,s=t.sort_direction;return n!=e?Object(i.jsx)("span",{className:"inactive",children:"\u25b2"}):"asc"==s?Object(i.jsx)("span",{children:"\u25b2"}):Object(i.jsx)("span",{children:"\u25bc"})}},{key:"clickHeader",value:function(e){var t=this,n=this.state,i=n.sort_key,s=n.sort_direction;i==e?s="asc"==s?"desc":"asc":(i=e,s="desc"),this.setState({sort_key:i,sort_direction:s},(function(){t.reloadTable()}))}},{key:"renderHeader",value:function(){var e=this;return Object(i.jsx)("div",{className:"infinite-header",children:Object(i.jsxs)("div",{className:"infinite-headerInner",children:[Object(i.jsxs)("div",{className:"c-col-0 c-cols",onClick:function(){return e.clickHeader("proposal.id")},children:[Object(i.jsx)("label",{className:"font-size-14",children:"#"}),this.renderTriangle("proposal.id")]}),Object(i.jsxs)("div",{className:"c-col-1 c-cols",onClick:function(){return e.clickHeader("proposal.title")},children:[Object(i.jsx)("label",{className:"font-size-14",children:"Title"}),this.renderTriangle("proposal.title")]}),Object(i.jsx)("div",{className:"c-col-2 c-cols",children:Object(i.jsx)("label",{className:"font-size-14",children:"Affiliate"})}),Object(i.jsxs)("div",{className:"c-col-3 c-cols",onClick:function(){return e.clickHeader("proposal.type")},children:[Object(i.jsx)("label",{className:"font-size-14",children:"Type"}),this.renderTriangle("proposal.type")]}),Object(i.jsxs)("div",{className:"c-col-4 c-cols",onClick:function(){return e.clickHeader("proposal.created_at")},children:[Object(i.jsx)("label",{className:"font-size-14",children:"Date"}),this.renderTriangle("proposal.created_at")]}),Object(i.jsx)("div",{className:"c-col-5 c-cols",children:Object(i.jsx)("label",{className:"font-size-14",children:"Action"})})]})})}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.search,s=this.props.authUser;return s&&s.id&&s.is_admin?Object(i.jsx)(f.Fade,{distance:"20px",bottom:!0,duration:200,delay:500,children:Object(i.jsxs)("section",{id:"app-pending-proposals-section",className:"app-infinite-box",children:[Object(i.jsxs)("div",{className:"app-infinite-search-wrap",children:[Object(i.jsx)("label",{children:"New Proposals (Admin Only)"}),Object(i.jsx)("input",{type:"text",value:n,onChange:this.handleSearch,placeholder:"Search..."})]}),Object(i.jsx)("div",{className:"infinite-content",children:Object(i.jsxs)("div",{className:"infinite-contentInner",children:[this.renderHeader(),Object(i.jsx)("div",{className:"infinite-body",id:"app-pending-proposals-sectionBody",children:t?Object(i.jsx)(x.k,{}):this.renderProposals()})]})})]})}):null}}]),n}(u.Component);t.default=Object(b.b)((function(e){return{authUser:e.global.authUser,pendingProposalTableStatus:e.admin.pendingProposalTableStatus}}))(Object(j.g)(S))}}]);